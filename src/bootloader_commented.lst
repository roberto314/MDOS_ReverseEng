 AS V1.42 Beta [Bld 216] - Source File bootloader_commented.asm - Page 1 - 01/17/2026 08:50:18 PM


       1/       0 :                     ; This file is loaded from floppy to address $20
       2/       0 :                     ; It sits in sector $17 @ 0xB80
       3/       0 :                     ;****************************************************
       4/       0 :                     ; Used Labels
       5/       0 :                     ;****************************************************
       6/       0 :                     
       7/       0 : =$0                  CURDRV  EQU     $0000
       8/       0 : =$1                  STRSCTH EQU     $0001
       9/       0 : =$2                  STRSCTL EQU     $0002
      10/       0 : =$3                  NUMSCTH EQU     $0003
      11/       0 : =$4                  NUMSCTL EQU     $0004
      12/       0 : =$5                  LSCTLN  EQU     $0005
      13/       0 : =$6                  CURADRH EQU     $0006
      14/       0 : =$7                  CURADRL EQU     $0007
      15/       0 : =$8                  FDSTAT  EQU     $0008
      16/       0 : =$B                  SECTCNTH EQU     $000B
      17/       0 : =$C                  SECTCNTL EQU     $000C
      18/       0 : =$1FFD               Z1FFD   EQU     $1FFD
      19/       0 : =$E800               OSLOAD  EQU     $E800
      20/       0 : =$E853               CHKERR  EQU     $E853
      21/       0 : =$E86D               READPS  EQU     $E86D
      22/       0 : =$E875               RESTOR  EQU     $E875
      23/       0 : =$EBC0               LPINIT  EQU     $EBC0
      24/       0 : =$F000               PWRUP   EQU     $F000
      25/       0 : =$F003               XBEGEN  EQU     $F003
      26/       0 : =$F006               XCBCDH  EQU     $F006
      27/       0 : =$F009               XCHEXL  EQU     $F009
      28/       0 : =$F00C               XCHEXR  EQU     $F00C
      29/       0 : =$F00F               XINADD  EQU     $F00F
      30/       0 : =$F012               XINCH   EQU     $F012
      31/       0 : =$F015               XINCHN  EQU     $F015
      32/       0 : =$F018               XOUTCH  EQU     $F018
      33/       0 : =$F01B               XOUT2H  EQU     $F01B
      34/       0 : =$F01E               XOUT4H  EQU     $F01E
      35/       0 : =$F021               XPCRLF  EQU     $F021
      36/       0 : =$F024               XPDATA  EQU     $F024
      37/       0 : =$F027               XPDAT   EQU     $F027
      38/       0 : =$F02A               XPSPAC  EQU     $F02A
      39/       0 :                     
      40/       0 :                     ;****************************************************
      41/       0 :                     ; Program's Code Areas
      42/       0 :                     ;****************************************************
      43/       0 :                     
      44/       0 :                     ; RIB from System disk
      45/       0 :                     ;      00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F
      46/       0 :                     ;-----------------------------------------------------
      47/       0 :                     ; 00 - 40 06 80 3F 00 00 00 00 00 00 00 00 00 00 00 00
      48/       0 :                     ; 10 - 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
      49/       0 :                     ; 20 - 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
      50/       0 :                     ; 30 - 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
      51/       0 :                     ; 40 - 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
      52/       0 :                     ; 50 - 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
      53/       0 :                     ; 60 - 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
      54/       0 :                     ; 70 - 00 00 00 00 00 10 00 40 01 00 06 23 00 00 00 00
      55/       0 :                     
      56/      20 :                                     ORG     $0020
      57/      20 :                     
      58/      20 : 7C 00 00                            INC     CURDRV                   ; 0020: 7C 00 00  ; Why?
      59/      23 : BD E8 75                            JSR     RESTOR                   ; 0023: BD E8 75  ; 
      60/      26 : BD EB C0                            JSR     LPINIT                   ; 0026: BD EB C0  ; 
 AS V1.42 Beta [Bld 216] - Source File bootloader_commented.asm - Page 2 - 01/17/2026 08:50:18 PM


      61/      29 : CE 00 A0                            LDX     #$00A0                   ; 0029: CE 00 A0  ; Start of RIB in Memory 128 + $20 = $A0
      62/      2C : A6 75                               LDAA    $75,X                    ; 002C: A6 75     ; RIB $75: the number of bytes to load from the last sector
      63/      2E : 97 05                               STAA    LSCTLN                   ; 002E: 97 05     ; LAST SECTOR LENGTH ($10)
      64/      30 : E6 00                               LDAB    ,X                       ; 0030: E6 00     ; X is at $A0, Get Segment descriptor word ($40)
      65/      32 : 2B 58                               BMI     SERRQM                   ; 0032: 2B 58     ; RIB SDW Bit 7 set - Error '?'
      66/      34 : C4 03                               ANDB    #$03                     ; 0034: C4 03     ; isolate Bit 0,1 - is part of starting cluster number
      67/      36 : A6 01                               LDAA    $01,X                    ; 0036: A6 01     ; LDA from $A1, Get Segment descriptor word ($06)
      68/      38 : 48                                  ASLA                             ; 0038: 48        ; 
      69/      39 : 59                                  ROLB                             ; 0039: 59        ; *2
      70/      3A : 48                                  ASLA                             ; 003A: 48        ; 
      71/      3B : 59                                  ROLB                             ; 003B: 59        ; *4 - four sectors / cluster (6 * 4 = 24)
      72/      3C : 8B 01                               ADDA    #$01                     ; 003C: 8B 01     ; |
      73/      3E : C9 00                               ADCB    #$00                     ; 003E: C9 00     ; +1 (25, $19)
      74/      40 : D7 01                               STAB    STRSCTH                  ; 0040: D7 01     ; |
      75/      42 : 97 02                               STAA    STRSCTL                  ; 0042: 97 02     ; Startsector (25, $19) 25*128=$C80
      76/      44 : A6 77                               LDAA    $77,X                    ; 0044: A6 77     ; |
      77/      46 : E6 76                               LDAB    $76,X                    ; 0046: E6 76     ; ($76,77), the number of sectors to load ($0040)
      78/      48 : 97 04                               STAA    NUMSCTL                  ; 0048: 97 04     ; |
      79/      4A : D7 03                               STAB    NUMSCTH                  ; 004A: D7 03     ; save
      80/      4C : E6 7A                               LDAB    $7A,X                    ; 004C: E6 7A     ; |
      81/      4E : A6 7B                               LDAA    $7B,X                    ; 004E: A6 7B     ; ($7A,7B), the starting execution address ($0623)
      82/      50 : 36                                  PSHA                             ; 0050: 36        ; 
      83/      51 : 37                                  PSHB                             ; 0051: 37        ; 
      84/      52 : EE 78                               LDX     $78,X                    ; 0052: EE 78     ; ($78,79), the starting load address ($0100)
      85/      54 : DF 06                               STX     CURADRH                  ; 0054: DF 06     ; save
      86/      56 : 96 04                               LDAA    NUMSCTL                  ; 0056: 96 04     ; 
      87/      58 : D6 03                               LDAB    NUMSCTH                  ; 0058: D6 03     ; 
      88/      5A : CE 00 07                            LDX     #$07                     ; 005A: CE 00 07  ; |
      89/      5D : 48                  Z005D           ASLA                             ; 005D: 48        ; |
      90/      5E : 59                                  ROLB                             ; 005E: 59        ; | multiply by 128 to get bytecount
      91/      5F : 09                                  DEX                              ; 005F: 09        ; |
      92/      60 : 26 FB                               BNE     Z005D                    ; 0060: 26 FB     ; |
      93/      62 : 9B 07                               ADDA    CURADRL                  ; 0062: 9B 07     ; |
      94/      64 : D9 06                               ADCB    CURADRH                  ; 0064: D9 06     ; add start address
      95/      66 : 97 0C                               STAA    SECTCNTL                 ; 0066: 97 0C     ; |
      96/      68 : D7 0B                               STAB    SECTCNTH                 ; 0068: D7 0B     ; is actually Endaddress
      97/      6A : CE 03 FF                            LDX     #$03FF                   ; 006A: CE 03 FF  ; 
      98/      6D : 86 4D               Z006D           LDAA    #$4D                     ; 006D: 86 4D     ; Check Memory @ $400 upwards
      99/      6F : 08                                  INX                              ; 006F: 08        ; 
     100/      70 : E6 00                               LDAB    ,X                       ; 0070: E6 00     ; Load whats there
     101/      72 : A7 00                               STAA    ,X                       ; 0072: A7 00     ; write $4D
     102/      74 : A1 00                               CMPA    ,X                       ; 0074: A1 00     ; compare
     103/      76 : 07                                  TPA                              ; 0076: 07        ; Transfer Status to A
     104/      77 : E7 00                               STAB    ,X                       ; 0077: E7 00     ; write the old value back
     105/      79 : 06                                  TAP                              ; 0079: 06        ; restore status reg.
     106/      7A : 26 18                               BNE     SERRM                    ; 007A: 26 18     ; if not zero - Error 'M'
     107/      7C : 9C 0B                               CPX     SECTCNTH                 ; 007C: 9C 0B     ; are we done?
     108/      7E : 26 ED                               BNE     Z006D                    ; 007E: 26 ED     ; no - continue
     109/      80 : 7F 00 00                            CLR     CURDRV                   ; 0080: 7F 00 00  ; go back to drive 0
     110/      83 : 86 53                               LDAA    #$53                     ; 0083: 86 53     ; |
     111/      85 : 36                                  PSHA                             ; 0085: 36        ; |
     112/      86 : 86 E8                               LDAA    #$E8                     ; 0086: 86 E8     ; |
     113/      88 : 36                                  PSHA                             ; 0088: 36        ; E853 is CHKERR
     114/      89 : 7E E8 6D                            JMP     READPS                   ; 0089: 7E E8 6D  ; on stack is CHKERR and Execution Address
     115/      8C :                     ;------------------------------------------------
     116/      8C : 86 3F               SERRQM          LDAA    #'?'                     ; 008C: 86 3F     ; 
     117/      8E : 97 08               Z008E           STAA    FDSTAT                   ; 008E: 97 08     ; 
     118/      90 : 0D                                  SEC                              ; 0090: 0D        ; 
     119/      91 : 7E E8 53                            JMP     CHKERR                   ; 0091: 7E E8 53  ; 
     120/      94 :                     
 AS V1.42 Beta [Bld 216] - Source File bootloader_commented.asm - Page 3 - 01/17/2026 08:50:18 PM


     121/      94 : 86 4D               SERRM           LDAA    #'M'                     ; 0094: 86 4D     ; 
     122/      96 : 20 F6                               BRA     Z008E                    ; 0096: 20 F6     ; 
     123/      98 :                     ;------------------------------------------------
     124/      98 : 00                                  FCB     $00                      ; 0098: 00        ; filler
     125/      99 : 00                                  FCB     $00                      ; 0099: 00        ; |
     126/      9A : 00                                  FCB     $00                      ; 009A: 00        ; |
     127/      9B : 00                                  FCB     $00                      ; 009B: 00        ; |
     128/      9C : 00                                  FCB     $00                      ; 009C: 00        ; |
     129/      9D : 00                                  FCB     $00                      ; 009D: 00        ; |
     130/      9E : 00                                  FCB     $00                      ; 009E: 00        ; |
     131/      9F : 00                                  FCB     $00                      ; 009F: 00        ; |
     132/      A0 :                     
     133/      A0 :                     
     134/      A0 :                                     END
 AS V1.42 Beta [Bld 216] - Source File bootloader_commented.asm - Page 4 - 01/17/2026 08:50:18 PM


  Symbol Table (* = unused):
  --------------------------

*ARCHITECTURE :                                      "x86_64-unknown-linux" - |
*BIGENDIAN :                      0 - | *BRANCHEXT :                      0 - |
*CASESENSITIVE :                  0 - |  CHKERR :                      E853 - |
*COMPMODE :                       0 - | *CONSTPI :        3.141592653589793 - |
 CURADRH :                        6 - |  CURADRL :                        7 - |
 CURDRV :                         0 - | *CUSTOM :                         0 - |
*DATE :                "01/17/2026" - | *FALSE :                          0 - |
 FDSTAT :                         8 - | *FULLPMMU :                       1 - |
*HAS64 :                          1 - | *HASDSP :                         0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
*INEXTMODE :                      0 - | *INLWORDMODE :                    0 - |
*INMAXMODE :                      0 - | *INSRCMODE :                      0 - |
*INSUPMODE :                      0 - | *LISTON :                         1 - |
 LPINIT :                      EBC0 - |  LSCTLN :                         5 - |
*MACEXP :                         7 - | *MOMCPU :                      6800 - |
*MOMCPUNAME :                "6800" - | *NESTMAX :                      100 - |
 NUMSCTH :                        3 - |  NUMSCTL :                        4 - |
*OSLOAD :                      E800 - | *PACKING :                        0 - |
*PADDING :                        0 - | *PWRUP :                       F000 - |
 READPS :                      E86D - | *RELAXED :                        0 - |
 RESTOR :                      E875 - |  SECTCNTH :                       B - |
 SECTCNTL :                       C - |  SERRM :                         94 C |
 SERRQM :                        8C C |  STRSCTH :                        1 - |
 STRSCTL :                        2 - | *TIME :               "08:50:18 PM" - |
*TRUE :                           1 - | *VERSION :                     142F - |
*XBEGEN :                      F003 - | *XCBCDH :                      F006 - |
*XCHEXL :                      F009 - | *XCHEXR :                      F00C - |
*XINADD :                      F00F - | *XINCH :                       F012 - |
*XINCHN :                      F015 - | *XOUT2H :                      F01B - |
*XOUT4H :                      F01E - | *XOUTCH :                      F018 - |
*XPCRLF :                      F021 - | *XPDAT :                       F027 - |
*XPDATA :                      F024 - | *XPSPAC :                      F02A - |
 Z005D :                         5D C |  Z006D :                         6D C |
 Z008E :                         8E C | *Z1FFD :                       1FFD - |
*Z80SYNTAX :                      0 - |

     68 symbols
     48 unused symbols

 AS V1.42 Beta [Bld 216] - Source File bootloader_commented.asm - Page 5 - 01/17/2026 08:50:18 PM


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.00 seconds assembly time

    135 lines source file
      2 passes
      0 errors
      0 warnings
