*6800ÅEDITORÅTOÅ"MEDIT"ÅFUNCTIONALÅSPECIFICATION*ÅNAMÅMEDIT*ÅTTLÅ6800ÅMACROÅEDITOR,ÅLEVELÅ2.2**PROGRAMMERÅD.ÅHATCH*ÅOPTÅO,S,NOG,LLEN=120,CREF**COPYRIGHTÅ(C)Å-Å1977ÅD.ÅHATCH**"ALLÅRIGHTSÅRESERVED"**DATEÇ30ÅNOVEMBERÅ1977ÅPAGE*6800ÅMEDITÅSYSTEMÅCONVENTIONS**Å1.ÅTHEÅINTENDEDÅPRINCIPLEÅOFÅEDITÅOPERATIONÅISÅTOÅMOVEÅTHEÅTEXTÅAS*LITTLEÅASÅREASONABLYÅPOSSIBLE.ÇINACTIVEÅTEXTÅISÅPACKEDÅAGAINSTÅTHE*STARTÅORÅFINISHÅOFÅTHEÅBUFFER,ÅANDÅLEFTÅTHERE.ÇACTIVEÅEDITINGÅIS*DONEÅINÅTHEÅ"PLAYGROUND"ÅGAPÅBETWEENÅTHESEÅINACTIVEÅBLOCKSÅOFÅTEXT.**Å2.ÅTHEÅLARGESTÅPERMISSIBLEÅVALUEÅOFÅTHEÅIMPLICITÅREPEATÅCOUNTÅFOR*AÅSINGLEÅACTIONÅ("ARG")ÅISÅLIMITEDÅTOÅ32KÅFORWARD,Å32K-1ÅBACKWARD.**THEÅDEFAULT,ÅANDÅMINIMUMÅ"+"ÅVALUEÅFORÅ("ARG")ÅPASSEDÅTOÅAÅCOMMAND*ACTIONÅSUBROUTINEÅISÅ1.ÇTOÅPERFORMÅTHEÅSYNTAXÅOFÅ"0A"ÅORÅ"0L"*THEÅ0ÅARGÅCASEÅISÅTRANSLATEDÅINTOÅ-1.ÇALLÅ"-"ÅARGÅVALUESÅBECOME*INCREASEDÅINÅABSOLUTEÅVALUEÅBYÅ1.**Å3.ÅINÅDELIMITINGÅAÅTEXTÅBUFFERÅAREA,ÅCHARACTERÅPOSITIONÅBUFSTÅISÅNOT*USED.ÇCHARACTERÅPOSITIONÅBUFNDÅISÅUSED**HEREÅANDÅDOTÅMARKÅTHEÅLASTÅCHARACTERÅPOSITIONÅINÅTHEÅFIRST*BLOCKÅOFÅTEXT.ÅIFÅTHEÅFIRSTÅBLOCKÅISÅEMPTY,ÅHEREÅANDÅDOTÅARE*SETÅTOÅBUFST.**THEREÅPOINTSÅTOÅTHEÅLASTÅPOSITIONÅINÅTHEÅTEXTÅGAP.ÇIF*THEÅENDÅBLOCKÅOFÅTEXTÅISÅEMPTY,ÅTHEREÅISÅSETÅEQUALÅTOÅBUFND.**EQULSÅMARKSÅTHEÅFOUNDÅCHARACTER*I.E.ÅEQULSÅISÅAÅCOPYÅOFÅANÅOLDÅDOTÅVALUE.**Å4.ÅTHEÅPOINTERÅSTRNGÅISÅSETÅUPÅFORÅUSEÅWITHÅTHEÅSTACKÅPOINTERÅASÅA*TEXTÅSCANÅPOINTER.ÇWHENÅUSINGÅXÅONÅSTRNG,ÅUSEÅ1,XÅASÅCURRENTÅVALUE.**Å5.Å<LF>ÅANDÅNULLÅCHARACTERSÅAREÅNOTÅREADÅORÅTYPEDÅINTOÅTHEÅBUFFER.**ONÅWRITEÅOUTPUT,Å<CR>ÅCHARACTERSÅAREÅEXPANDEDÅTOÅ<CR><LF>.**DURINGÅKEYBOARDÅINPUT,ÅVARIOUSÅFACILITIESÅAREÅAVAILABLE:**<CNT>HÅECHOSÅ&ÅDELETESÅTHEÅLASTÅCHARACTERÅTYPED*<RUB>ÅBACKSPACESÅ&ÅDELETESÅTHEÅLASTÅCHARACTERÅTYPEDÅ(VDU'SÅONLY)*<CNT>XÅDELETESÅTHEÅCOMPLETEÅCURRENTÅCOMMANDÅ&ÅRE-ISSUESÅPROMPT*<CNT>PÅRESTARTSÅMEDITÅ(ESCAPEÅFROMÅNESTING/USERÅINTERACTION)***KEYBOARDÅECHOÅUSESÅTHEÅTYPEÅFACILITY,ÅWITHÅTHEÅFOLLOWINGÅFUNCTIONS:**ONÅTYPEÅOUTPUT,Å<CR>ÅCHARACTERSÅAREÅEXPANDEDÅTOÅ<CR><LF>,Å(COUNT)<NUL>*ONÅTYPEÅOUTPUTÅ<ESC>ÅCHARACTERSÅAREÅPRINTEDÅASÅ"$".*ONÅTYPEÅOUTPUTÅ<SUB>ÅCHARACTERSÅAREÅPRINTEDÅASÅ"?"ÅPAGE*ASCIIÅCHARACTERÅDEFINITIONS*RUBÅEQUÅ$7FÅASCIIÅRUBOUTÅ<DEL>CNTHÅEQUÅ$08ÅASCIIÅCONTROLÅHÅ<BS>CNTXÅEQUÅ$18ÅASCIIÅCONTROLÅXÅ<CAN>CNTPÅEQUÅ$10ÅASCIIÅCONTROLÅPÅ<DLE>*BELÅEQUÅ$07ÅASCIIÅ"BELL"CRÅEQUÅ$0DÅASCIIÅCARRIAGEÅRETURNLFÅEQUÅ$0AÅASCIIÅLINEÅFEEDSBÅEQUÅ$1AÅASCIIÅ"SUBSTITUTE"ESÅEQUÅ$1BÅASCIIÅ"ESCAPE"SPÅEQUÅ$20ÅASCIIÅSPACEÅSPCÅ3*EXTENDEDÅOPÅCODEÅDEFINITIONSÅ&ÅMACROSÅSPCÅ1*SKIPÅINSTRUCTIONS:**THESEÅMACROSÅSKIPÅ1Å&Å2ÅBYTESÅRESPECTIVELY.*CONDITIONÅCODESÅN,Z,VÅAREÅALTERED*CONDITIONÅCODEÅCÅREMAINSÅUNCHANGEDÅSPCÅ1*SKIP1Ç(USESÅ"BITÅTESTÅACCUMULATORÅAÅIMMEDIATE"ÅOPCODE)ÅSPCÅ1SKIP1ÅMACRÅFCBÅ$85ÅENDMÅSPCÅ1*SKIP2Ç(USESÅ"COMPAREÅINDEXÅREGISTERÅIMMEDIATE"ÅOPCODE)ÅSPCÅ1SKIP2ÅMACRÅFCBÅ$8CÅENDMÅPAGE*THISÅVERSIONÅISÅSETÅUPÅFORÅMOTOROLAÅEXORCISERÅMDOSÅ2ÅOPERATION*USINGÅRAMÅMEMORYÅUPÅTOÅTHEÅLIMITÅDEFINEDÅBYÅMEMND**I/OÅDEFINITIONSÅFORÅUSEÅWITHÅMOTOROLAÅMDOSÅ&ÅEXBUGÅ1.1Å&Å1.2*CBUFP$ÅEQUÅ$FEÅMDOSÅCOMMANDÅBUFFERÅPOINTERENDSY$ÅEQUÅ$10AÅENDÅOFÅSYSTEMÅR.A.M.I$EOFÅEQUÅ9ÅENDÅOFÅFILEI$NONMÅEQUÅ7ÅERRORÅ"FILEÅNAMEÅNOTÅFOUND"I$FTYPÅEQUÅ$AÅERRORÅ"INVALIDÅFILEÅTYPE"DT$OPOÅEQUÅ2ÅOPENÅOUTPUTÅMODEDT$CLSÅEQUÅ$10ÅFILEÅCLOSEDÅFLAGIOCSTAÅEQUÅ0ÅERRORÅSTATUSIOCDTTÅEQUÅ1ÅDATAÅTRANSFERÅTYPEIOCLUNÅEQUÅ$AÅLOGICALÅUNITÅNUMBERIOCFDFÅEQUÅ$17ÅFILEÅDESCRIPTORÅFLAGSIOCSBPÅEQUÅ$1DÅSECTORÅBUFFERÅPOINTER/INITIALÅALLOCATION.RESRVÅEQUÅ0ÅRESERVEÅAÅDEVICE.RELESÅEQUÅ1ÅRELEASEÅAÅDEVICE.OPENÅEQUÅ2ÅOPENÅAÅFILE.CLOSEÅEQUÅ3ÅCLOSEÅAÅFILE.GETRCÅEQUÅ4ÅREADÅAÅRECORD.PUTRCÅEQUÅ5ÅWRITEÅAÅRECORD*.MOVEÅEQUÅ$10ÅMOVEÅAÅSTRING.MDENTÅEQUÅ$1AÅENTERÅMDOSÅWITHOUTÅRELOADING.DIRSMÅEQUÅ$1CÅDIRECTORYÅSEARCHÅ&ÅMODIFY.PFNAMÅEQUÅ$1DÅPROCESSÅFILEÅNAME.CHANGÅEQUÅ$1FÅDIRECTORYÅCHANGE.MDERRÅEQUÅ$20ÅMDOSÅERRORÅMESSAGEÅHANDLER*PUTCHÅEQUÅ$F018ÅEXBUGÅOUTPUTÅ1ÅCHARACTERÅ(CONSOLE)*PAGESZÅEQUÅ50ÅSETÅPAGEÅSIZEÅ=Å50ÅLINESÅPAGE*MEMORYÅCONTENTÅDEFINITIONS*ÅORGÅ$20ÅSETÅBASEÅABOVEÅDISKÅDRIVEÅVARIABLES**CURRENTÅBUFFERÅDEFINITIONÅMAP*DOTÅRMBÅ2ÅCURRENTÅTEXTÅPOSITIONÅMARKEREQULSÅRMBÅ2ÅPREVIOUSÅTEXTÅPOSITIONÅMARKERMARKÅRMBÅ2ÅDEFINEDÅTEXTÅPOSITIONÅMEMORYHEREÅRMBÅ2ÅSTARTÅOFÅTHEÅTEXTÅGAPTHEREÅRMBÅ2ÅENDÅOFÅTHEÅTEXTÅGAPBUFSTÅRMBÅ2ÅSTARTÅOFÅTHEÅTEXTÅBUFFERBUFNDÅRMBÅ2ÅENDÅOFÅTHEÅTEXTÅBUFFER**COMMANDÅBUFFERÅDEFINITIONÅMAP*STRNGÅRMBÅ2ÅOBJECTÅSTRINGÅSCANÅPOINTERSTCPYÅRMBÅ2ÅSTRNGÅCOPYÅSAVEÅLOCATIONSTPARÅRMBÅ2ÅPARTIALÅMATCHÅPOINTÅONÅOBJECTÅSTRINGCMDSTÅRMBÅ2ÅSTARTÅOFÅTHEÅCOMMANDÅBUFFERCMBELÅRMBÅ2ÅCOMMANDÅBUFFERÅENDÅWARNINGÅPOINTCMDNDÅRMBÅ2ÅENDÅOFÅTHEÅCOMMANDÅBUFFER**CURRENTÅPROCESSÅVARIABLEÅLOCATIONS*POINTÅRMBÅ2ÅTEXTÅSCANÅPOINTERPOIN1ÅRMBÅ2ÅTEXTÅSCANÅPOINTERÅ#1CHRCTÅRMBÅ2ÅCHARACTERÅCOUNTLINMKÅRMBÅ2ÅLINEÅPOSITIONÅMARKERDTCPYÅRMBÅ2ÅDOTÅCOPYÅSAVEÅLOCATIONNUMHÅRMBÅ1ÅDECIMALÅNUMBERÅPACKÅLOCATIONÅ(H)Å(ARGÅH)NUMLÅRMBÅ1ÅDECIMALÅNUMBERÅPACKÅLOCATIONÅ(L)Å(ARGÅL)ARGÅEQUÅNUMHÅREPEATÅCOUNTÅORÅARGUMENTARCPYÅRMBÅ2ÅARGÅCOPYÅSAVEÅLOCATIONARSGNÅRMBÅ1ÅARGUMENTÅSIGN,Å"-"ÅFLAGÅ-Å=Å$FFVFLAGÅRMBÅ1ÅVERIFYÅON/OFFÅSWITCHÅFLAGNUMBRÅRMBÅ1ÅNUMBERÅSAVEÅLOCATIONPROMCÅRMBÅ1ÅPROMPTÅCHARACTERÅ&ÅYOURGOÅFLAGEOFFLÅRMBÅ1ÅEND-OF-FILEÅFLAGBKCTRÅRMBÅ1ÅCOMMANDÅCHECKÅPASSÅBRACKETÅPAIRÅCOUNTER*STKPTÅRMBÅ2ÅSTACKÅPOINTERÅSAVEÅLOCATIONEDSTKÅRMBÅ2ÅEDITORÅSTACKÅPOINTERÅRETURNÅLOCATIONÅPAGEÅORGÅ$2000ÅALLOCATEÅTHEÅSUBROUTINEÅ&ÅFUNCTIONÅNESTINGÅSTACK*ÅFCCÅ/COPYRIGHTÅ(C)Å1977Å-ÅD.ÅHATCH/***MEDITÅSUBROUTINEÅSTACKÅLINKAGEÅISÅALLOCATEDÅ32ÅBYTESÅ^*Å(CONSIDEREDÅONÅTOPÅOFÅTHEÅMAXIMUMÅNESTINGÅSTACK)*ÅRMBÅ128ÅALLOWÅ128ÅBYTESÅFORÅOPERATINGÅSTACKÅRMBÅ32ÅALLOWÅ"<>"ÅNESTINGÅFORÅ8ÅLEVELSÅDEEPÅRMBÅ8ÅALLOCATEÅLINKAGEÅFORÅTHEÅCOMMANDÅSWITCHÅJSRSTACKÅEQUÅ*ÅTHISÅISÅTHEÅASSIGNEDÅSTACKÅBASEÅADDRESSÅRMBÅ1ÅSTARTÅTHEÅPROGRAMÅROUTINESÅIMMEDIATELYÅAFTERÅTHEÅSTACK***à*SUBROUTINEÅLOOKCHARACTER**LOOKSÅATÅTHEÅDEBUGÅBOARDÅACIAÅINPUTÅSIDE.ÇIFÅAÅCHARACTERÅISÅREADY*ITÅISÅRETURNEDÅINÅACCUMULATORÅAÅ&ÅC=1,ÅELSEÅC=0.ÇTHEÅROUTINE*DOESÅNOTÅWAITÅFORÅAÅCHARACTERÅIFÅONEÅISÅNOTÅPRESENT,ÅBUTÅRETURNS*IMMEDIATELY.ÇTHEÅCONDITIONÅCODEÅ"C"ÅBITÅADVISESÅPRESENCE/ABSENCE*OFÅANÅINPUTÅCHARACTERÅONÅRETURN.**ACIASÅEQUÅ$FCF4ÅEXORCISERÅACIAÅSTATUSACIARÅEQUÅ$FCF5ÅEXORCISERÅACIAÅDATAÅREGISTER*LOOKCÅLDAAÅACIASÅREADÅTHEÅACIAÅSTATUSÅREGISTERÅASRAÅIFÅAÅCHARACTERÅISÅAVAILABLEÅBCCÅLOOK1ÅTHENÅLDAAÅACIARÅREADÅTHEÅCHARACTERÅ(C=1)ÅANDAÅ#$7FÅSTRIPÅTHEÅPARITYÅBITLOOK1ÅRTSÅANDÅRETURN***EDITÅABORTÅEXITÅTOÅEXBUGÅ(ALLÅTEXTÅISÅLOST)*EXBUGÅEQUÅ$F000ÅEXBUGÅENTRYÅPOINT*ABORTÅJMPÅEXBUGÅJUMPÅTOÅEXBUGÅ&ÅNEVERÅCOMEÅBACK***NULCTÅFCBÅ$7ÅOUTPUTÅ7ÅNULLSÅAFTERÅEACHÅ<LF>ÅPAGE*MEDITÅSYSTEMÅSUBROUTINES**à*SUBROUTINEÅDOTFORWARD**THISÅSUBROUTINEÅMOVESÅTHEÅTEXTÅGAPÅFORWARDÅTOWARDÅTHEÅENDÅOFÅTHEÅTEXT*BUFFER,ÅTOÅTHEÅPOSITIONÅDEFINEDÅBYÅTHEÅINDEXÅREGISTERÅX.ÇNOÅTESTÅIS*PERFORMEDÅCONSIDERINGÅTHEÅPOSSIBILITYÅOFÅREACHINGÅTHEÅBUFFERÅEND.*AFTERÅEXECUTIONÅOFÅTHISÅSUBROUTINE,ÅDOTÅMARKSÅTHEÅPOSITIONÅOF*THEÅLASTÅCHARACTERÅOFÅTHEÅFIRSTÅSECTIONÅOFÅTHEÅTEXTÅ(=Å"HERE").*THISÅISÅALSOÅTHEÅBEGINNINGÅOFÅTHEÅTEXTÅBUFFERÅGAPÅ"HERE"Å-Å"THERE"**DTFWDÅSTXÅLINMKÅDEFINEÅTHEÅTARGETÅPOSITIONÅLDABÅLINMK+1ÅCALCULATEÅTHEÅDIFFERENCEÅLDAAÅLINMKÅBETWEENÅTHEÅTARGETÅPOSITIONÅSUBBÅTHERE+1ÅANDÅTHEÅCURRENTÅPOSITIONÅSBCAÅTHEREÅGIVINGÅAÅCHARACTERÅCOUNTÅSTAAÅCHRCTÅ(LSBÅISÅHELDÅINÅACCÅB)ÅLDXÅHEREÅLOADÅTHEÅCURRENTÅTEXTÅGAPÅSTARTÅSTSÅSTKPTÅSAVEÅTHEÅCURRENTÅSTACKÅPOINTERÅLDSÅTHEREÅLOADÅTHEÅCURRENTÅTEXTÅGAPÅENDÅBRAÅDTFW2ÅCONSIDERÅAÅ0ÅLENGTHÅGAPÅMOVE*DTFW1ÅPULAÅMOVEÅAÅCHARACTERÅBACKWARDÅSTAAÅ1,XÅACROSSÅTHEÅGAP,ÅTHEREBYÅINXÅMOVINGÅTHEÅGAPÅFORWARDÅONEÅCHARACTERDTFW2ÅSUBBÅ#$01ÅWHILEÅCHARACTERSÅBCCÅDTFW1ÅCONTINUEÅLDAAÅCHRCTÅCONSIDERÅHIGHÅBYTEÅOFÅCOUNTÅSUBAÅ#$01ÅWHILEÅCHARACTERSÅSTAAÅCHRCTÅREMAINÅTOÅMOVEÅBCCÅDTFW1ÅCONTINUE,ÅELSE**ÅSTSÅTHEREÅSETÅTHEÅNEWÅTEXTÅGAPÅENDÅSTXÅHEREÅSETÅTHEÅNEWÅTEXTÅGAPÅSTARTÅSTXÅDOTÅSETÅTHEÅNEWÅCURRENTÅTEXTÅPOSITIONÅLDSÅSTKPTÅRESTOREÅTHEÅSTACKÅPOINTERÅRTSÅANDÅRETURNÅPAGE*à*SUBROUTINEÅDOTBACKWARD**THISÅSUBROUTINEÅMOVESÅTHEÅTEXTÅGAPÅBACKÅTOWARDÅTHEÅSTARTÅOFÅTHEÅTEXT*BUFFERÅTOÅTHEÅPOSITIONÅDEFINEDÅBYÅTHEÅINDEXÅREGISTERÅX.ÇNOÅTESTÅIS*PERFORMEDÅCONSIDERINGÅTHEÅPOSSIBILITYÅOFÅREACHINGÅTHEÅBUFFERÅSTART.*AFTERÅEXECUTIONÅOFÅTHISÅSUBROUTINE,ÅDOTÅMARKSÅTHEÅPOSITIONÅOF*THEÅLASTÅCHARACTERÅOFÅTHEÅFIRSTÅSECTIONÅOFÅTHEÅTEXTÅ(="HERE").*THISÅISÅALSOÅTHEÅBEGINNINGÅOFÅTHEÅTEXTÅBUFFERÅGAPÅ"HERE"Å-Å"THERE"**DTBKWÅSTXÅLINMKÅDEFINEÅTHEÅTARGETÅPOSITIONÅSTSÅSTKPTÅSAVEÅTHEÅCURRENTÅSTACKÅPOINTERÅLDXÅHEREÅLOADÅTHEÅCURRENTÅTEXTÅGAPÅENDÅLDSÅTHEREÅLOADÅTHEÅCURRENTÅTEXTÅGAPÅSTARTÅBRAÅDTBK2ÅCONSIDERÅAÅ0ÅLENGTHÅTEXTÅGAPÅMOVE*DTBK1ÅLDAAÅ0,XÅMOVEÅAÅCHARACTERÅFORWARDÅPSHAÅACROSSÅTHEÅGAP,ÅTHEREBYÅDEXÅMOVINGÅTHEÅGAPÅBACKWARDÅONEÅCHARACTERDTBK2ÅCPXÅLINMKÅUNTILÅTHEÅDEFINEDÅLOCATIONÅBNEÅDTBK1ÅTHEN*DTBK3ÅSTXÅHEREÅSETÅTHEÅNEWÅTEXTÅGAPÅSTARTÅSTXÅDOTÅSETÅTHEÅNEWÅCURRENTÅTEXTÅPOSITIONÅSTSÅTHEREÅSETÅTHEÅNEWÅTEXTÅGAPÅENDÅLDSÅSTKPTÅRESTOREÅTHEÅSTACKÅPOINTERÅRTSÅANDÅRETURNÅPAGE*à*SUBROUTINEÅCHARACTERFORWARD**THISÅSUBROUTINEÅFINDSÅTHEÅ(ARG)THÅCHARACTERÅFORWARD,ÅANDÅLEAVES*THATÅADDRESSÅ(BACKÅONEÅCHARACTER)ÅINÅINDEXÅREGISTERÅX.*IFÅTHEÅENDÅOFÅTHEÅBUFFERÅISÅENCOUNTERED,ÅTHEÅPROCESSÅWILLÅSTOP*ANDÅTHEÅVALUEÅOFÅBUFNDÅWILLÅBEÅLEFTÅINÅINDEXÅREGISTERÅX.**CHRFWÅLDABÅARG+1ÅTRAVELÅ(ARG)ÅCHARACTERSÅFORWARDÅLDXÅTHEREÅSTARTÅATÅTHEÅFORWARDÅENDÅOFÅTHEÅTEXTÅGAP*CHRF1ÅCPXÅBUFNDÅIFÅNOTÅATÅTHEÅBUFFERÅENDÅBEQÅCHRF2ÅTHENÅINXÅGOÅAÅCHARACTERÅPOSITIONÅ(FORWARD)ÅDECBÅCOUNTÅOFFÅTHEÅCHARACTERÅBNEÅCHRF1ÅWHILEÅCHARACTERSÅDECÅARGÅCONTINUEÅ(32ÅKÅMAX!)ÅBPLÅCHRF1ÅELSE*CHRF2ÅRTSÅRETURN***à*SUBROUTINEÅCHRACTERBACKWARD**THISÅSUBROUTINEÅFINDSÅTHEÅ(ARG)THÅCHARACTERÅBACKWARD,ÅANDÅLEAVES*THATÅADDRESSÅINÅINDEXÅREGISTERÅX.*IFÅTHEÅSTARTÅOFÅTHEÅBUFFERÅISÅENCOUNTERED,ÅTHEÅPROCESSÅWILLÅSTOP*ANDÅTHEÅVALUEÅOFÅBUFSTÅWILLÅBEÅLEFTÅINÅINDEXÅREGISTERÅX.**CHRBKÅLDABÅARG+1ÅTRAVELÅ(ARG)ÅCHARACTERSÅBACKWARDÅLDXÅHEREÅSTARTÅATÅTHEÅBEGINNINGÅOFÅTHEÅTEXTÅGAPÅBRAÅCHRB2ÅALLOWÅFORÅ-ÅARGÅBEINGÅ+1ÅONÅREQUESTEDÅVALUE*CHRB1ÅCPXÅBUFSTÅIFÅNOTÅATÅBUFFERÅSTARTÅBEQÅCHRB3ÅTHENÅDEXÅGOÅAÅCHARACTERÅPOSITIONÅ(BACKWARD)CHRB2ÅDECBÅCOUNTÅOFFÅTHEÅCHARACTERÅBNEÅCHRB1ÅWHILEÅCHARACTERSÅDECÅARGÅCONTINUEÅ(32ÅKÅMAX!)ÅBPLÅCHRB1ÅELSE*CHRB3ÅRTSÅRETURNÅPAGE*à*SUBROUTINEÅLINEFORWARD**THISÅSUBROUTINEÅFINDSÅTHEÅ<CR>ÅOFÅTHEÅ(ARG)THÅLINEÅFORWARD,*ANDÅLEAVESÅTHATÅADDRESSÇINÅINDEXÅREGISTERÅX.*IFÅTHEÅENDÅOFÅTHEÅBUFFERÅISÅENCOUNTERED,ÅTHEÅPROCESS*WILLÅSTOP,ÅANDÅTHEÅVALUEÅOFÅBUFNDÅWILLÅBEÅLEFTÅINÅINDEXÅREGISTERÅX.**LNFWDÅLDXÅTHEREÅSTARTÅONÅTHEÅFORWARDÅENDÅOFÅTHEÅTEXTÅGAPÅLDAAÅ#CRÅTOÅLOOKÅFORÅASCIIÅ<CR>ÅCHARACTERSÅLDABÅARG+1ÅFORÅ(ARG)ÅTIMES,ÅORÅTOÅTHEÅBUFFERÅENDÅBRAÅLNFW3ÅCONSIDERÅALREADYÅATÅBUFFERÅEND*LNFW1ÅCMPAÅ1,XÅIFÅTHISÅCHARACTERÅISÅNOTÅAÅ<CR>ÅBEQÅLNFW4ÅTHENLNFW2ÅINXÅTAKEÅTHEÅNEXTÅCHARACTERÅINÅTHEÅBUFFERLNFW3ÅCPXÅBUFNDÅIFÅATÅENDÅOFÅTEXTÅBUFFERÅBNEÅLNFW1ÅTHENÅRTSÅMARKÅENDÅOFÅBUFFERÅ&ÅRETURN*LNFW4ÅDECBÅCOUNTÅTHISÅ<CR>ÅINSTANCEÅBNEÅLNFW2ÅWHILEÅLINES,ÅCONTINUEÅDECÅARGÅIFÅALLÅLINESÅDONEÅ(32KÅMAX!)ÅBPLÅLNFW2ÅTHEN*ÅINXÅGOÅTOÅFOUNDÅ<CR>(ARG)ÅRTSÅMARKÅTHEÅFOUNDÅLOCATIONÅ&ÅRETURN***à*SUBROUTINEÅLINEBACKWARD**THISÅSUBROUTINEÅFINDSÅTHEÅ<CR>ÅOFÅTHEÅ(ARG+1)THÅLINEÅBACKWARD,*ANDÅLEAVESÅTHATÅADDRESSÇINÅINDEXÅREGISTERÅX.*IFÅTHEÅSTARTÅOFÅTHEÅBUFFERÅISÅENCOUNTERED,ÅTHEÅPROCESS*WILLÅSTOP,ÅANDÅTHEÅVALUEÅOFÅBUFSTÅWILLÅBEÅLEFTÅINÅINDEXÅREGISTERÅX.**LNBKWÅLDXÅHEREÅSTARTÅONÅTHEÅBACKÅENDÅOFÅTHEÅTEXTÅGAPÅLDAAÅ#CRÅTOÅLOOKÅFORÇASCIIÅ<CR>ÅCHARACTERSÅLDABÅARG+1ÅFORÅ(ARG)ÅTIMES,ÅORÅTOÅTHEÅBUFFERÅSTARTÅBRAÅLNBK3ÅCONSIDERÅALREADYÅATÅBUFFERÅSTART*LNBK1ÅCMPAÅ0,XÅIFÅTHISÅCHARACTERÅISÅNOTÅAÅ<CR>ÅBEQÅLNBK4ÅTHENLNBK2ÅDEXÅTAKEÅTHEÅPREVIOUSÅCHARACTERLNBK3ÅCPXÅBUFSTÅIFÅATÅSTARTÅOFÅTEXTÅBUFFERÅBNEÅLNBK1ÅTHENÅRTSÅMARKÅSTARTÅOFÅBUFFERÅ&ÅRETURN*LNBK4ÅDECBÅCOUNTÅTHISÅ<CR>ÅINSTANCEÅBNEÅLNBK2ÅWHILEÅLINES,ÅCONTINUEÅDECÅARGÅIFÅALLÅLINESÅDONEÅ(32KÅMAX!)ÅBPLÅLNBK2ÅTHEN*ÅRTSÅMARKÅTHEÅFOUNDÅLOCATIONÅ&ÅRETURNÅPAGE*MEDITÅSYSTEMÅCOMMANDÅACTIONÅSUBROUTINES****à*COMMANDÅACTIONÅSUBROUTINEÅSEARCHÅFORWARD**COMPARESÅSEARCHÅOBJECTÅSTRINGÅWITHÅTEXTÅBUFFER,ÅROLLINGÅTHE*COMPARISONÅSTARTÅPOINTÅFORWARDÅONEÅCHARACTERÅALONGÅTHEÅTEXT*BUFFERÅBYÅONEÅCHARACTERÅATÅEACHÅMATCHÅFAILURE.**IFÅTHEÅFIRSTÅCHARACTERÅOFÅTHEÅPASSEDÅOBJECTÅSTRINGÅISÅAÅ<SUB>*ITÅISÅCONSUMEDÅBYÅSEARCHÅASÅAÅCOMMANDÅTOÅINVOKEÅTHEÅ<SUB>=*<UNIVERSALÅMATCHÅOBJECTÅCHARACTER>ÅFUNCTION.**EQULSÅISÅLEFTÅPRECEEDINGÅTHEÅFOUNDÅINSTANCEÅOFÅTHEÅSEARCHÅSTRING**DOTÅISÅLEFTÅATÅTHEÅENDÅOFÅTHEÅFOUNDÅINSTANCEÅOFÅTHEÅSEARCHÅSTRING.*IFÅTHEÅSEARCHÅENCOUNTERSÅTHEÅENDÅOFÅTHEÅBUFFER,ÅTHEÅPROCESS*TERMINATES,ÅANDÅDOTÅISÅLEFTÅATÅTHEÅENDÅOFÅTHEÅBUFFER.**(ARG)ÅNUMBERÅOFÅINSTANCESÅOFÅTHEÅOBJECTÅSTRINGÅMUSTÅBEÅFOUND*IFÅSEARCHÅISÅTOÅBEÅSUCCESFUL.**SERCFÅBSRÅSRCHFÅSEARCHÅFORWARDÅBVCÅSERTNÅIFÅFAILUREÅLDXÅ#SFLMSÅSELECTÅ"SEARCHÅFAIL"ÅMESSAGEÅJSRÅPRINSÅPRINTÅTHEÅMESSAGEÅSTRINGÅSECÅFLAGÅTHEÅFAILUREÅ(TERMINATEÅCOMMANDÅSTRINGÅHERE)SERTNÅRTSÅPAGE*à*COMMANDÅACTIONÅSUBROUTINEÅSEARCHÅFILE**PERFORMSÅAÅ"SEARCHÅFORWARD"ÅCOMMANDÅONÅTHEÅCURRENTÅTEXTÅBUFFER.ÇIF*UNSUCESSFUL,ÅAÅ50ÅLINEÅPAGEÅISÅPUNCHEDÅOUTÅFROMÅTHEÅBEGINNINGÅOF*THEÅBUFFER,ÅANDÅAÅNEWÅ50ÅLINEÅPAGEÅISÅREADÅINÅATÅTHEÅENDÅOFÅBUFFER.*SEARCHÅISÅTHENÅCONTINUED.ÇTHISÅPROCESSÅWILLÅCONTINUEÅUNTILÅSEARCH*REQUIREMENTÅISÅSATISFIED,ÅORÅTHEÅENDÅOFÅTHEÅFILEÅISÅREACHED.ÉIF*THEÅENDÅOFÅTHEÅFILEÅISÅREACHED,ÅTHEÅREMAININGÅTEXTÅWILLÅBEÅWRITTEN*TOÅTHEÅOUTPUTÅFILE,ÅANDÅTHEÅOUTPUTÅFILEÅWILLÅBEÅCLOSED.Å(=EXIT)**DOÅNOTÅATTEMPTÅAÅSEARCHÅFILEÅCOMMANDÅWITHÅLESSÅTHANÅTWOÅ50ÅLINE*PAGESÅINÅTHEÅBUFFER.Å(THEÅFIRSTÅPARTÅOFÅAÅSEARCHÅOBJECTÅCOULDÅBE*WRITTENÅOUTÅBEFOREÅITÅWASÅRECOGNIZED.ÅSEARCHÅWOULDÅFAILÅ&ÅEXIT)**DOÅNOTÅATTEMPTÅTOÅSEARCHÅFORÅANÅOBJECTÅSTRINGÅOFÅMOREÅTHANÅ255*CHARACTERS.ÅIFÅTHISÅISÅATTEMPTED,ÅTHEÅBUFFERÅENDÅPARTIALÅMATCH*MECHANISMÅMAYÅFAIL.Å(SEARCHÅWOULDÅFAILÅ&ÅEXIT)**SFILEÅBSRÅSRCHFÅSEARCHÅTHISÅBUFFERÅBVCÅSERTNÅIFÅFOUND,ÅEXITÅ(SUCCESS)ÅLDAÅAÅEOFFLÅIFÅEND-OF-FILEÅBMIÅEXIJ1ÅTHENÅEXIT,ÅELSEÅLDXÅSTCPYÅUSINGÅTHEÅCOPYÅSTXÅSTRNGÅRESETÅTHEÅSEARCHÅSTRINGÅPOINTERÅLDAÅAÅARGÅTAKEÅTHEÅCURRENTÅCOUNTÅPSHÅAÅ(MATCHESÅTOÅFINDÅSTILLÅUNSATISFIED)ÅLDAÅAÅARG+1ÅANDÅSAVEÅITÅONÅTHEÅSTACKÅPSHÅAÅFORÅUSEÅINÅTHEÅNEXTÅPAGEÅSEARCHEDÅJSRÅBEGINÅTURNÅTOÅTHEÅBEGINNINGÅOFÅTHEÅTEXTÅBUFFERÅLDXÅ#PAGESZÅDEFINEÅPAGEÅSIZEÅSTXÅARGÅFORÅTHEÅWRITEÅOPERATIONÅCLRÅARSGNÅDEFINEÅWRITEÅFORWARDÅJSRÅWRITEÅWRITEÅAÅPAGEÅ(IFÅAVAILABLE)ÅTOÅTHEÅOUTPUTÅBUFFERÅJSRÅENDBFÅTURNÅTOÅTHEÅENDÅOFÅTHEÅREMAININGÅTEXTÅLDAAÅSTPAR+1ÅIFÅAÅSTRINGÅMATCHÅHASÅBEENÅSUBAÅSTCPY+1ÅPARTIALLYÅFOUNDÅBEQÅSFIL1ÅTHENÅINCAÅALLOWÅFORÅ-ARGÅBEINGÅARG+1ÅSTAAÅARG+1ÅSETÅ-ARGÅTOÅSIZEÅOFÅPARTIALÅMATCHÅFOUNDÅCLRÅARGÅSOÅTHATÅPARTIALÅMATCHÅCANÅBEÅFOUNDÅAGAINÅJSRÅJUMP0ÅMOVEÅPOINTERSÅBACKÅTOÅBEGINNINGÅOFÅPARTIALÅMATCHSFIL1ÅLDXÅ#PAGESZÅDEFINEÅNUMBERÅOFÅLINESÅINÅPAGEÅSTXÅARGÅFORÅAÅREADÅOPERATIONÅJSRÅREADÅREADÅINÅAÅPAGEÅ(IFÅAVAILABLE)ÅPULÅAÅRETRIEVEÅTHEÅCURRENTÅSTAÅAÅARG+1ÅUNSATISFIEDÅSTRINGÅMATCHÅCOUNTÅPULÅAÅFORÅTHISÅSTRINGÅSEARCHÅOPERATIONÅSTAÅAÅARGÅFORÅTHEÅNEXTÅSEARCHÅPASSÅBRAÅSFILEÅSEARCHÅTHEÅNEWÅTEXTÅ(&ÅPOSSIBLEÅPREVIOUSÅPARTIALÅMATCH)*EXIJ1ÅLDXÅ#FLEMSÅSELECTÅ"FILEÅEND"ÅMESSAGEÅJSRÅPRINSÅPRINTÅOUTÅTHEÅMESSAGEÅSTRINGÅJMPÅEXITÅWRITEÅOUTÅTHEÅREMAININGÅTEXTÅ&ÅCLOSEÅTHEÅOUTPUTÅFILEÅPAGE*ÅSUBROUTINEÅSEARCHÅFORWARD*SRCHFÅLDXÅSTRNGÅMAKEÅAÅCOPYÅOFÅSTXÅSTCPYÅTHEÅSTRINGÅPOINTERÅLDXÅTHEREÅSTARTÅATÅTHEÅENDÅOFÅTHEÅTEXTÅGAPÅSTXÅEQULSÅMARKÅTHEÅSEARCHÅSTARTÅPOSITIONÅSTSÅSTKPTÅSAVEÅTHEÅCURRENTÅSTACKÅPOINTERÅLDSÅSTRNGÅSTARTÅONÅTHEÅSEARCHÅOBJECTÅSTRINGÅLDABÅARG+1ÅFORÅ(ARG)ÅMATCHES,ÅORÅTOÅTHEÅBUFFERÅENDÅPULAÅIFÅTHEÅFIRSTÅPASSEDÅCHARACTERÅCMPAÅ#SBÅISÅANÅASCIIÅSUBÅBNEÅNOSUBÅTHENÅSTSÅSTRNGÅUSEÅUPÅTHEÅCOMMANDÅSWITCHÅJMPÅSERS2ÅCONSIDERÅATÅTHEÅENDÅOFÅTHEÅBUFFERÅ(USEÅ<SUB>ÅFACILITY)**SNXNSÅLDXÅEQULSÅROLLÅSTRINGÅCOMPARISONÅSTARTÅPOINTÅFORWARDÅ1ÅINXÅ(BEGINÅSTRINGÅCOMPARISONÅAGAIN)SNANSÅSTXÅEQULSÅRECORDÅNEWÅCOMPARISONÅSTARTÅPOINTÅLDSÅSTRNGÅSTARTÅAGAINÅONÅTHEÅSEARCHÅOBJECTÅSTRINGÅBRAÅSERN2ÅCONSIDERÅATÅENDÅOFÅBUFFER**NOSUBÅDESÅLEAVEÅFIRSTÅCHARACTERÅASÅPARTÅOFÅOBJECTÅSTRINGÅBRAÅSERN2ÅCONSIDERÅATÅENDÅOFÅBUFFER*SERN1ÅPULAÅIFÅTHEÅOBJECTÅCHARACTERÅCMPAÅ#ESÅISÅNOTÅ<ESC>Å(STRINGÅTERMINATOR)ÅBEQÅSERN3ÅTHENÅCMPAÅ1,XÅIFÅITÅISÅEQUALÅTOÅITSÅCOUNTERPARTÅBNEÅSNXNSÅTHENÅINXÅTAKEÅTHEÅNEXTÅCHARACTERÅPOSITIONÅFORWARDSERN2ÅCPXÅBUFNDÅIFÅATÅBUFFERÅENDÅBNEÅSERN1ÅTHENÅPAGE*ÅUSEÅUPÅTHEÅSEARCHÅOBJECTÅSTRING*SERFLÅSTSÅSTPARÅRECORDÅANYÅPARTIALÅMATCHÅACHIEVEDÅPULÅAÅWHILEÅTHEÅOBJECTÅCHARACTERÅCMPÅAÅ#ESÅISÅNOTÅ<ESC>Å(ENDÅOFÅOBJECTÅSTRING)ÅBNEÅSERFLÅCONTINUEÅCONSUMINGÅTHEÅOBJECTÅSTRINGÅSTSÅSTRNGÅUSEÅUPÅTHEÅTEXTÅSTRINGÅLDSÅSTKPTÅRESTOREÅTHEÅSTACKÅPOINTERÅJSRÅDTFWDÅMOVEÅTHEÅTEXTÅGAPÅTOÅTHEÅFOUNDÅPOSITIONÅCLCÅREPORTÅ"NOÅDISASTROUSÅERRORS"ÅSEVÅREPORTÅ"BUFFERÅENDÅTERMINATION"ÅRTSÅANDÅRETURN*SERN3ÅDECBÅCOUNTÅTHISÅINSTANCEÅASÅFOUNDÅBNEÅSNANSÅIFÅTHEREÅISÅTOÅBEÅAÅREPEATÅDECÅARGÅWHILEÅREPEATÅCOUNTÅ(32KÅMAX!)ÅBPLÅSNANSÅCONTINUE,ÅELSE*SERN4ÅSTSÅSTRNGÅUSEÅUPÅTHEÅOBJECTÅSTRINGÅLDSÅSTKPTÅRESTOREÅTHEÅSTACKÅPOINTERÅSTXÅDTCPYÅSAVEÅTHEÅFOUNDÅPOSITIONÅLDXÅEQULSÅSELECTÅTHEÅFOUNDÅSTRINGÅSTARTÅJSRÅDTFWDÅMOVEÅTHEÅTEXTÅGAPÅTOÅTHEÅFOUNDÅSTRINGÅSTARTÅLDXÅDOTÅMOVEÅTHEÅ"EQULS"ÅTEXTÅPOSITIONÅSTXÅEQULSÅACROSSÅTHEÅGAPÅLDXÅDTCPYÅSELECTÅTHEÅFOUNDÅSTRINGÅENDÅJSRÅDTFWDÅMOVEÅTHEÅTEXTÅGAPÅTOÅTHEÅFOUNDÅSTRINGÅENDÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURN**SNXSBÅLDXÅEQULSÅROLLÅSTRINGÅCOMPARISONÅSTARTÅPOINTÅFORWARDÅ1ÅINXÅ(BEGINÅSTRINGÅCOMPARISONÅAGAIN)SNASBÅSTXÅEQULSÅRECORDÅTHEÅNEWÅCOMPARISONÅSTARTÅPOINTÅLDSÅSTRNGÅSTARTÅOVERÅONÅSEARCHÅOBJECTÅSTRINGÅBRAÅSERS2ÅCONSIDERÅATÅENDÅOFÅBUFFER*SERS3ÅDECBÅCOUNTÅTHISÅINSTANCEÅASÅFOUNDÅBNEÅSNASBÅIFÅTHEREÅISÅTOÅBEÅAÅREPEATÅDECÅARGÅWHILEÅREPEATÅCOUNTÅ(32KÅMAX!)ÅBMIÅSERN4ÅCONTINUEÅBRAÅSNASBÅSEARCHÅFORÅTHEÅNEXTÅINSTANCE*SERS1ÅPULAÅIFÅTHEÅOBJECTÅCHARACTERÅCMPAÅ#ESÅISÅNOTÅ<ESC>Å(STRINGÅTERMINATOR)ÅBEQÅSERS3ÅTHENÅCMPAÅ1,XÅIFÅITÅISÅEQUALÅTOÅITSÅCOUNTERPARTÅBEQÅSERSFÅORÅCMPAÅ#SBÅISÅANÅASCIIÅ<SUB>Å(UNIVERSALÅMATCHÅCHARACTER)ÅBNEÅSNXSBÅTHENSERSFÅINXÅTAKEÅTHEÅNEXTÅCHARACTERÅPOSITIONÅFORWARDSERS2ÅCPXÅBUFNDÅIFÅATÅBUFFERÅENDÅBNEÅSERS1ÅTHENÅBRAÅSERFLÅEXITÅ"SEARCHÅFAIL"ÅPAGE*à*COMMANDÅACTIONÅSUBROUTINEÅINSERT**THEÅOBJECTÅTEXTÅSTRINGÅISÅENTEREDÅINTOÅTHEÅTEXTÅBUFFERÅUNTIL*THEÅ<ESC>ÅSTRINGÅTERMINATORÅISÅFOUND.ÉTHEÅTEXTÅISÅENTERED*BEGINNINGÅATÅ"HERE"ÅANDÅPROCEEDSÅFORWARDÅFROMÅTHATÅPOINTÅINTO*THEÅTEXTÅGAP.**AFTERÅCOMPLETIONÅOFÅTHEÅINSERT,ÅEQULSÅISÅSETÅTOÅTHEÅLOCATION*WHEREÅTHEÅINSERTÅBEGANÅ(THEÅOLDÅ"DOT"Å&Å"HERE"ÅLOCATION),*WHILEÅ"DOT"ÅANDÅ"HERE"ÅAREÅSETÅFOLLOWINGÅTHEÅLASTÅCHARACTER*OFÅTHEÅINSERTEDÅTEXT.**IFÅAÅREPEATÅCOUNTÅWASÅSPECIFIED,ÅTHEÅINSERTÅWILLÅREPEATÅ(ARG)*TIMES.Ç"EQULS"ÅWILLÅMARKÅTHEÅSTARTÅOFÅTHEÅFIRSTÅREPEAT,Ç"DOT"*ANDÅ"HERE"ÅWILLÅMARKÅTHEÅENDÅOFÅTHEÅLASTÅREPEAT.**INSRTÅLDXÅHEREÅSTARTÅATÅTHEÅBEGINNINGÅOFÅTHEÅTEXTÅGAPÅSTXÅEQULSÅREMEMBERÅTHEÅSTARTÅLOCATIONINSREÅSTSÅSTKPTÅSAVEÅTHEÅCURRENTÅSTACKÅPOINTERÅLDABÅARG+1ÅGETÅTHEÅLOWÅBYTEÅOFÅTHEÅREPEATÅCOUNT*INSR0ÅLDSÅSTRNGÅSTARTÅONÅTHEÅTEXTÅSPECIFIEDÅBRAÅINSR2ÅCONSIDERÅ0ÅLENGTHÅINSERT,ÅORÅNOÅROOM*INSR1ÅSTAAÅ1,XÅPUTÅTHISÅCHARACTERÅINÅTHEÅBUFFERÅINXÅTAKEÅTHEÅNEXTÅCHARACTERÅPOSITIONÅFORWARDINSR2ÅPULAÅGETÅAÅCHARACTERÅFROMÅTHEÅINSERTÅTEXTÅCMPAÅ#ESÅIFÅNOTÅANÅ<ESC>Å(STRINGÅTERMINATOR)ÅBEQÅINSR3ÅTHENÅCPXÅTHEREÅIFÅNOÅROOMÅINÅTHEÅTEXTÅGAPÅBNEÅINSR1ÅTHEN**NOTE:ÅTHEÅOBJECTÅSTRINGÅISÅNOTÅPREDICTABLYÅUSEDÅUP*AFTERÅANÅINSERTÅFAILUREÅHASÅOCCURED.*ÅSTXÅHEREÅSETÅ"HERE"ÅANDÅ"DOT"ÅTOÅTHEÅENDÅOFÅTHEÅSTXÅDOTÅPARTIALÅINSERTÅALREADYÅACHIEVEDÅLDSÅSTKPTÅRESTOREÅTHEÅSTACKÅPOINTERÅLDXÅ#NRMMSÅSELECTÅ"NOÅROOM"ÅMESSAGEÅJSRÅPRINSÅPRINTÅMESSAGEÅSTRINGÅSECÅFLAGÅFAILUREÅ(C=1)ÅRTSÅANDÅRETURN*INSR3ÅDECBÅCOUNTÅTHISÅCOMPLETEDÅINSERTÅBNEÅINSR0ÅIFÅTHEREÅISÅTOÅBEÅAÅREPEATÅCOUNTÅDECÅARGÅWHILEÅREPEATÅCOUNTÅ(32KÅMAX!)ÅBPLÅINSR0ÅCONTINUE,ÅELSE*ÅSTXÅHEREÅSETÅ"HERE"ÅANDÅ"DOT"ÅTOÅENDÅSTXÅDOTÅOFÅCOMPLETEDÅINSERTÅSTSÅSTRNGÅUSEÅUPÅINSERTÅTEXTÅ&Å<ESC>ÅLDSÅSTKPTÅRESTOREÅTHEÅSTACKÅPOINTERÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURNÅPAGE*à*COMMANDÅACTIONÅSUBROUTINEÅDELETE**DELETESÅTHEÅNUMBERÅOFÅCHARACTERSÅSPECIFIEDÅFROMÅTHEÅTEXTÅBUFFER.*IFÅTHEÅSPECIFIEDÅCOUNTÅISÅ+,ÅCHARACTERSÅAREÅDELETEDÅFROMÅ"THERE"*FORWARDS.ÇIFÅTHEÅSPECIFIEDÅCOUNTÅISÅ-,ÅCHARACTERSÅAREÅDELETED*FROMÅ"HERE"ÅBACKWARDS.ÇAFTERÅCOMPLETIONÅOFÅTHEÅDELETEÅOPERATION,*"DOT",Å"HERE"ÅANDÅ"THERE"ÅAREÅRESETÅONÅTHEÅNEWÅTEXTÅGAP.**DELETÅLDAAÅARSGNÅIFÅAÅ"-"ÅVALUEÅWASÅREQUESTEDÅBPLÅDLET1ÅTHENÅJSRÅCHRBKÅGOÅ(ARG)ÅCHARACTERSÅBACKWARDÅSTXÅHEREÅDELETEÅTHEMÅSTXÅDOTÅANDÅSETÅTHEÅCURRENTÅTEXTÅPOSITIONÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURN*DLET1ÅJSRÅCHRFWÅGOÅ(ARG)ÅCHARACTERSÅFORWARDÅSTXÅTHEREÅANDÅDELETEÅTHEMÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURNÅPAGE*à*COMMANDÅACTIONÅSUBROUTINEÅCHANGEÅFORWARD**CHANGESÅ(ARG)ÅOCCURENCESÅOFÅ<STRINGÅ#1>ÅINTOÅOCCURENCESÅOFÅ<STRINGÅ#2>*EQULSÅANDÅDOTÅAREÅSETÅTOÅTHEÅBEGINNINGÅANDÅEND,ÅRESPECTIVELY,ÅOFÅTHE*LASTÅINSTANCEÅOFÅ<STRINGÅ#2>ÅPRODUCEDÅBYÅTHISÅPROCESS.**NOTEÅTHATÅ<STRINGÅ#2>ÅMAYÅBEÅNULL,ÅINÅWHICHÅCASEÅ(ARG)ÅOCCURENCESÅOF*<STRINGÅ#1>ÅWILLÅBEÅDELETEDÅFROMÅTHEÅTEXTÅBUFFER.**CHNGFÅLDXÅARGÅIFÅTHEREÅAREÅCHANGESÅTOÅDOÅ(ARGÅWASÅNOTÅ0)ÅBEQÅCHNEXÅTHENÅSTXÅARCPYÅCOPYÅARG,ÅFORÅLOOPÅCONTROL*CHNG1ÅLDXÅ#1ÅDEFINEÅANÅ"ARG"ÅOFÅ1ÅSTXÅARGÅ(FINDÅTHEÅFIRSTÅOCCURENCEÅOFÅ<STRINGÅ#1>)ÅJSRÅSERCFÅSEARCHÅFORÅ<STRINGÅ#1>ÅBCCÅCHNG2ÅIFÅBUFFERÅENDÅTERMINATION,ÅTHEN**ÅUSEÅUPÅINSERTÅOBJECTÅSTRING,ÅCLEANLYÅTERMINATINGÅTHISÅFUNCTION.*ÅSTSÅSTKPTÅSAVEÅTHEÅCURRENTÅSTACKÅPOINTERÅLDSÅSTRNGÅLOOKÅATÅTHEÅOBJECTÅTEXTÅSTRINGCHNGCÅPULÅAÅIFÅTHEÅCURRENTÅOBJECTÅCHARACTERÅCMPÅAÅ#ESÅISÅNOTÅ<ESC>Å(OBJECTÅSTRINGÅTERMINATOR)ÅBNEÅCHNGCÅCONTINUE,ÅCONSUMINGÅTHEÅOBJECTÅSTRINGÅSTSÅSTRNGÅUSEÅUPÅTHEÅTEXTÅSTRINGÅLDSÅSTKPTÅRESTOREÅTHEÅSTACKÅPOINTERÅBRAÅCHNFLÅREPORTÅ"CHANGE"ÅQUALIFIERÅONÅSEARCHÅFAIL*CHNG2ÅLDXÅ#1ÅDEFINEÅANÅ"ARG"ÅOFÅ1ÅSTXÅARGÅ(INSERTÅONEÅCOPYÅOFÅ<STRINGÅ#2>)ÅLDXÅEQULSÅOVERWRITEÅ<STRINGÅ#1>ÅJSRÅINSREÅINSERTÅ<STRINGÅ#2>ÅBCSÅCHNFLÅIFÅSUCCESS,ÅTHEN*ÅJSRÅVERFCÅ(OPTIONALLY)ÅVERIFYÅTHEÅCHANGE*ÅLDXÅARCPYÅIFÅTHEÅREPEATÅCOUNTÅDEXÅISÅNOTÅSATISFIEDÅSTXÅARCPYÅ(MOREÅCHANGESÅTOÅDO)ÅBEQÅCHNEXÅTHEN*ÅLDXÅSTCPYÅGOÅBACKÅTOÅTHEÅ<STRINGÅ#1/#2>ÅSTXÅSTRNGÅTOÅREPEATÅTHEÅOBJECTÅDATAÅBRAÅCHNG1ÅANDÅCHANGEÅANOTHERÅINSTANCEÅOFÅ<STRINGÅ#1>*CHNFLÅLDXÅ#CHNGMÅSELECTÅ"ÅCHANGE"ÅMESSAGEÅJSRÅPRINSÅPRINTÅMESSAGEÅSTRINGÅSECÅFLAGÅFAILUREÅ(C=1)ÅRTSÅANDÅRETURN*CHNEXÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURNÅPAGE*à*COMMANDÅACTIONÅSUBROUTINEÅCHANGEÅWHOLEÅBUFFER**STARTINGÅFROMÅTHEÅBEGINNINGÅOFÅTHEÅBUFFER,ÅCHANGESÅALLÅOCCURRENCESÅOF*<STRINGÅ#1>ÅTOÅOCCURRENCESÅOFÅ<STRINGÅ#2>.ÅTHEÅTEXTÅGAPÅWILLÅBEÅLEFT*ATÅTHEÅENDÅOFÅTHEÅBUFFER.*WHOLEÅJSRÅBEGINÅSETÅDOTÅTOÅTHEÅSTARTÅOFÅTHEÅFILEÅLDXÅ#$7FFEÅDEFINEÅTHEÅBIGGESTÅARGUMENTÅSTXÅARGÅANDÅPUTÅITÅAWAYÅJMPÅCHNGFÅTHENÅDOÅTHEÅCHANGES***à*COMMANDÅACTIONÅSUBROUTINEÅBEGINNING**MOVESÅTHEÅTEXTÅGAPÅTOÅTHEÅBEGINNINGÅOFÅTHEÅTEXTÅBUFFER.ÇDOTÅANDÅHERE*AREÅSETÅEQUALÅTOÅBUFST.ÇTHEÅTEXTÅISÅFOUNDÅBEGINNINGÅATÅTHERE,ÅAND*REACHINGÅTOÅBUFND.*BEGINÅLDXÅBUFSTÅSELECTÅTHEÅSTARTÅOFÅTHISÅBUFFERÅJSRÅDTBKWÅMOVEÅTHEÅTEXTÅGAPÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURN***à*COMMANDÅACTIONÅSUBROUTINEÅENDBUFFER**MOVESÅTHEÅTEXTÅGAPÅTOÅTHEÅENDÅOFÅTHEÅTEXTÅBUFFER.ÇDOTÅANDÅHERE*AREÅSETÅATÅTHEÅENDÅOFÅALLÅTHEÅTEXT.ÇTHEÅTEXTÅISÅFOUNDÅBEGINNING*ATÅBUFST,ÅREACHINGÅTOÅDOTÅ&ÅHERE.ÇTHEREÅISÅSETÅTOÅBUFND.**ENDBFÅLDXÅBUFNDÅSELECTÅTHEÅENDÅOFÅTHISÅBUFFERÅJSRÅDTFWDÅMOVEÅTHEÅTEXTÅGAPÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURN***à*COMMANDÅACTIONÅSUBROUTINEÅJUMP**MOVESÅDOTÅANDÅTHEÅTEXTÅGAPÅ+ÅORÅ-Å(ARG)ÅCHARACTERS.**JUMPÅLDAAÅARSGNÅIFÅAÅ"-"ÅVALUEÅWASÅREQUESTEDÅBPLÅJUMP1ÅTHENJUMP0ÅJSRÅCHRBKÅGOÅ(ARG)ÅCHARACTERSÅBACKWARDÅJSRÅDTBKWÅMOVEÅTHEÅTEXTÅGAPÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURN*JUMP1ÅJSRÅCHRFWÅGOÅ(ARG)ÅCHARACTERSÅFORWARDÅJSRÅDTFWDÅMOVEÅTHEÅTEXTÅGAPÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURNÅPAGE*à*COMMANDÅACTIONÅSUBROUTINEÅADVANCE**MOVESÅDOTÅANDÅTHEÅTEXTÅGAPÅ+ÅORÅ-Å(ARG)ÅLINES.ÇDOTÅISÅLEFTÅAFTERÅTHE*<CR>ÅOFÅTHEÅDEFINEDÅTARGETÅLINE.Ç0ÅAÅWILLÅSETÅDOTÅTOÅPOSITIONÅ0ÅON*THEÅCURRENTÅLINE.**ADVNCÅLDAAÅARSGNÅIFÅAÅ"-"ÅVALUEÅWASÅREQUESTEDÅBPLÅADVN1ÅTHENÅJSRÅLNBKWÅGOÅ(ARG)ÅLINESÅBACKWARDÅJSRÅDTBKWÅMOVEÅTHEÅTEXTÅGAPÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURN*ADVN1ÅJSRÅLNFWDÅGOÅ(ARG)ÅLINESÅFORWARDÅJSRÅDTFWDÅMOVEÅTHEÅTEXTÅGAPÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURN***à*COMMANDÅACTIONÅSUBROUTINEÅKILL**FORWARD:ÅDELETESÅTEXTÅTOÅ&ÅINCLUDINGÅTHEÅ(ARG)THÅ<CR>ÅFORWARD.*BACKWARD:ÅDELETESÅTEXTÅBACKÅTOÅBUTÅNOTÅINCLUDINGÅTHEÅ(ARG)THÅ<CR>.*Å0ÅKÅDELETESÅTHEÅTEXTÅOFÅTHEÅCURRENTÅLINEÅFROMÅTHEÅPRECEEDINGÅ<CR>*TOÅTHEÅCURRENTÅDOTÅPOSITION.**KILLÅLDAAÅARSGNÅIFÅAÅ"-"ÅVALUEÅWASÅREQUESTEDÅBPLÅKILL1ÅTHENÅJSRÅLNBKWÅGOÅ(ARG)ÅLINESÅBACKWARDÅSTXÅDOTÅSETÅTHEÅCURRENTÅTEXTÅPOSITIONÅTHEREÅSTXÅHEREÅDELETEÅTHEÅINTERVENINGÅTEXTÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURN*KILL1ÅJSRÅLNFWDÅGOÅ(ARG)ÅLINESÅFORWARDÅSTXÅTHEREÅDELETEÅTHEÅINTERVENINGÅTEXTÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURNÅPAGE*à*COMMANDÅACTIONÅSUBROUTINEÅAPPEND**APPENDSÅ(ARG)ÅBLOCKSÅOFÅ50ÅLINESÅTOÅTHEÅTEXTÅINÅTHEÅBUFFER.*FUNCTIONÅASÅFORÅREAD,ÅWITHÅARGÅXÅ50.ÇMAXÅARGÅISÅ511ÅBLOCKS.**APPNDÅLDAAÅNUMLÅGETÅTHEÅCURRENTÅLDABÅNUMHÅARGÅVALUEÅBITBÅ#$FEÅIFÅITÅEXCEEDSÅ511ÅBEQÅAPPN1ÅTHENÅLDXÅ#TOMANÅSELECTÅ"TOOÅMANY"ÅMESSAGEÅJSRÅPRINSÅPRINTÅMESSAGEÅSTRINGÅSECÅFLAGÅFAILUREÅ(C=1)ÅRTSÅANDÅRETURN**MULTIPLYÅITÅBYÅ50*APPN1ÅASLAÅROLBÅXÅ2ÅADDAÅNUMLÅADCBÅNUMHÅXÅ3ÅASLAÅROLBÅXÅ6ÅASLAÅROLBÅXÅ12ÅASLAÅROLBÅXÅ24ÅADDAÅNUMLÅADCBÅNUMHÅXÅ25ÅASLAÅROLBÅXÅ50**B,AÅNOWÅCONTAINÅ(ARG)ÅXÅ50*ÅSTAAÅNUMLÅSETÅARGÅTOÅTHEÅSTABÅNUMHÅXÅ50ÅVALUE**FALLÅINTOÅCOMMANDÅACTIONÅSUBROUTINEÅ"READ"*TOÅPERFORMÅTHEÅAPPENDÅFUNCTION.ÅPAGE*à*COMMANDÅACTIONÅSUBROUTINEÅREAD**READSÅ(ARG)ÅLINESÅFROMÅTHEÅINPUT,ÅINTOÅTHEÅTEXTÅBUFFER.ÇNEWÅTEXTÅIS*APPENDEDÅTOÅANYÅTEXTÅALREADYÅINÅTHEÅBUFFER.ÇEQULSÅISÅSETÅTOÅTHEÅSTART*OFÅTHEÅNEWÅMATERIALÅREADÅIN.ÇDOTÅWILLÅREMAINÅINÅTHEÅPRESENTÅPOSITION*ASÅWILLÅTHEÅTEXTÅGAP.ÇREADÅWILLÅTERMINATEÅATÅEOFÅORÅWITHÅA*LIMITÅCONDITION.ÇTHEÅLIMITÅCONDITIONÅISÅDEFINEDÅASÅTHEÅFIRSTÅ<CR>*READÅAFTERÅTHEÅRESERVEÅSPACEÅHASÅFALLENÅBELOWÅ1024ÅCHARACTERS,ÅORÅTHE*ABSOLUTEÅLIMITÅOFÅ256ÅRESERVEÅCHARACTERSÅISÅREACHED,ÅWHICHEVERÅOCCURS*FIRST.Ç(I.E.ÅROOMÅWILLÅBEÅRESERVEDÅINÅTHEÅBUFFERÅFORÅSIGNIFICANTÅEDIT*ACTIVITYÅAFTERÅREADING.)**DURINGÅAÅREAD,Å<NUL>Å&Å<LF>ÅCHARACTERSÅWILLÅBEÅREJECTED.Ç<NUL>Å&Å<LF>*CHARACTERSÅWILLÅNOTÅBEÅENTEREDÅINTOÅTHEÅBUFFERÅIFÅREAD.**READÅLDAAÅEOFFLÅIFÅNOTÅALREADYÅENDÅOFÅFILEÅBMIÅREADXÅTHENÅBSRÅRDSUBÅCOMPUTEÅTHEÅSPACEÅLEFTÅBNEÅREAD0ÅTHENÅLDXÅ#NRMMSÅSELECTÅ"NOÅROOM"ÅMESSAGEÅJSRÅPRINSÅPRINTÅMESSAGEÅSTRINGÅSECÅFLAGÅFAILUREÅ(C=1)ÅRTSÅANDÅRETURN*RDSUBÅLDAÅAÅTHERE+1ÅCALCULATEÅTHEÅSIZEÅOFÅLDAÅBÅTHEREÅTHEÅTEXTÅSPACEÅSUBÅAÅHERE+1ÅSTAÅAÅCHRCT+1ÅANDÅSTOREÅINÅCHRCTÅSBCÅBÅHEREÅSTAÅBÅCHRCTÅRTSÅRETURNÅWITHÅHIGHÅORDERÅCC'S*READ0ÅLDXÅDOTÅCOPYÅTHEÅCURRENTÅTEXTÅPOSITIONÅSTXÅDTCPYÅANDÅSAVEÅITÅFORÅRESTORATIONÅAFTERÅREADINGÅLDXÅBUFNDÅSELECTÅTHEÅENDÅOFÅTHISÅBUFFERÅJSRÅDTFWDÅANDÅMOVEÅTHEÅTEXTÅGAPÅPAGEREAD1ÅLDXÅHEREÅSETÅMDOSÅINXÅSTEPÅOVERÅFINALÅ<CR>ÅSTXÅINCDBSÅRECORDÅBUFFERÅPOINTERSÅLDXÅTHEREÅSTXÅINCDBEÅTOÅTEXTÅGAPÅLDXÅ#INIOCBÅSETÅUPÅINPUTÅIOCBÅSWIÅCALLÅMDOSÅTOÅGETÅAÅRECORDÅFCBÅ.GETRCÅBEQÅRDNEFÅIFÅERRORÅCMPÅBÅ#I$EOFÅCHECKÅFORÅEOFÅBEQÅRDEOFÅANDÅSETÅFLAGÅCLRÅBÅELSEÅSWIÅREPORTÅTHEÅERRORÅFCBÅ.MDERRRDEOFÅLDAÅAÅ#-1ÅDEFINEÅAÅNEGATIVEÅSTAÅAÅEOFFLÅANDÅSTOREÅBRAÅREADN*RDNEFÅLDXÅINCDBPÅGETÅENDÅOFÅRECORDÅSTXÅHEREÅANDÅUPDATEÅTEXTÅSIZEÅBSRÅRDSUBÅCALCULATEÅSPACEÅLEFTÅBEQÅREADNÅIFÅ.LT.Å256,ÅSTOP*READ2ÅLDXÅARGÅIFÅTHISÅLINEÅ(<CR>ÅTERMINATOR)ÅDEXÅWASÅNOTÅTHEÅLASTÅREQUESTEDÅBEQÅREADNÅTHENÅSTXÅARGÅMAINTAINÅTHEÅCOUNTÅOFÅ<CR>'SÅLDAAÅCHRCTÅHAVINGÅSEENÅAÅ<CR>ÅCMPAÅ#4ÅIFÅLESSÅTHANÅ1024ÅCHARÅSPACESÅREMAINÅBCCÅREAD1ÅTHENÅEXIT,ÅELSEÅCONTINUE*READNÅLDXÇDTCPYÅTURNÅBACKÅTOÅTHEÅSAVEDÅTEXTÅPOSITIONÅJSRÅDTBKWÅMOVEÅTHEÅTEXTÅGAPREADXÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURNÅPAGE*à*COMMANDÅACTIONÅSUBROUTINEÅWRITE**FORWARD:ÅWRITESÅ&ÅDELETESÅTEXTÅTOÅ&ÅINC.ÅTHEÅ(ARG)Å<CR>ÅFORWARD.*BACKWARD:ÅWRITESÅ&ÅDELETESÅTEXTÅBACKÅTOÅBUTÅNOTÅINC.ÅTHEÅ(ARG)Å<CR>.**NOTEÅTHATÅDOTÅISÅFORCEDÅTOÅTHEÅBEGINNINGÅOFÅTHEÅCURRENTÅLINEÅBEFORE*THEÅCOMMANDÅISÅPERFORMED.**EOFÅCLEANUPÅISÅNOTÅPERFORMEDÅINÅWRITE.ÇEDITÅISÅIMPLICITLYÅASSUMED*TOÅBEÅCONTINUING.**DURINGÅWRITE,Å<CR>ÅCHARACTERSÅAREÅEXPANDEDÅINTOÅ<CR><LF>ÅPAIRS.**WRITEÅLDXÅARGÅTAKEÅAÅCOPYÅOFÅARGÅSTXÅARCPYÅFORÅTHEÅMAINÅJOBÅLDXÅ#1ÅDEFINEÅ1Å<CR>ÅBACKÅSTXÅARGÅASÅTEMPORARYÅTOÅREQUESTÅJSRÅLNBKWÅGOÅTOÅTHEÅSTARTÅOFÅTHEÅCURRENTÅLINEÅJSRÅDTBKWÅTEXTÅGAP,ÅCURRENTÅPOSITIONÅ&ÅALLÅLDXÅARCPYÅUSINGÅTHEÅCOPYÅSTXÅARGÅRESTOREÅTHEÅREQUESTEDÅLINEÅCOUNTÅLDAAÅARSGNÅIFÅAÅ"-"ÅVALUEÅWASÅREQUESTEDÅBPLÅWRIT1ÅTHENÅJSRÅLNBKWÅGOÅ(ARG)ÅLINESÅBACKWARDÅSTXÅDOTÅSETÅTHEÅCURRENTÅTEXTÅPOSITIONÅTHEREÅCPXÅHEREÅIFÅNOÅTEXTÅBEQÅWRIT3ÅEXITÅNOWÅINXÅFIDDLEÅFORÅFIRSTÅCHARACTERÅSTXÅOTCDBSÅSETÅRECORDÅSTARTÅATÅDOTÅLDXÅHEREÅENDÅENDÅHEREÅSTXÅOTCDBEÅLDXÅ#OTIOCBÅUSEÅOUTPUTÅIOCBÅSWIÅANDÅWRITEÅRECORDÅOUTÅFCBÅ.PUTRCÅBEQÅWRNERÅCHECKÅFORÅERRORSWRTERÅCLRÅBÅREPORTÅUNIF.ÅI/OÅERRORÅSWIÅVIAÅMDOSÅFCBÅ.MDERRÅSECÅFLAGÅFAILUREÅRTSÅANDÅGOÅBACKÅPAGEWRNERÅLDXÅDOTÅUSINGÅTHEÅCURRENTÅTEXTÅPOSITIONÅSTXÅHEREÅDELETEÅTHEÅOUTPUTÅTEXTWRIT3ÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURN*WRIT1ÅJSRÅLNFWDÅGOÅ(ARG)ÅLINESÅFORWARDÅSTXÅLINMKÅMARKÅTHEÅENDÅADDRESSÅSTXÅOTCDBEÅSETÅRECORDÅENDÅLDXÅTHEREÅANDÅRECORDÅSTARTÅTHEREÅCPXÅOTCDBEÅIFÅNOÅTEXTÅTOÅOUTPUTÅBEQÅWRIT2ÅEXITÅNOWÅINXÅFIDDLEÅFORÅFIRSTÅCHARACTERÅSTXÅOTCDBSÅLDXÅ#OTIOCBÅUSINGÅOUTPUTÅIOCBÅSWIÅWRITEÅTHEÅRECORDÅFCBÅ.PUTRCÅBNEÅWRTERÅCHECKÅERRORSÅLDXÅLINMKÅIFÅNONE,DELETEÅTEXTÅSTXÅTHEREÅTOÅMARKERWRIT2ÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURNÅPAGE*à*COMMANDÅACTIONÅSUBROUTINEÅTYPE**TYPESÅLINESÅONÅTHEÅOPERATOR'SÅCONSOLE.ÇTHEÅCURRENTÅLINEÅISÅTYPED*ASÅAÅFRAGMENTÅIFÅTHEÅCURRENTÅPOSITIONÅISÅNOTÅATÅTHEÅBEGINNINGÅOF*THEÅCURRENTÅLINE.**FORWARD:ÅTYPESÅLINESÅFROMÅDOTÅTOÅANDÅINCLUDINGÅTHEÅ(ARG)THÅ<CR>*BACKWARD:ÅTYPESÅLINESÅFROMÅTHEÅ(ARG)THÅ<CR>ÅBACKÅTOÅDOT**TYPEÅLDAAÅARSGNÅIFÅAÅ"-"ÅVALUEÅWASÅREQUESTEDÅBPLÅTYPE2ÅTHENÅJSRÅLNBKWÅGOÅ(ARG)ÅLINESÅBACKWARDÅBRAÅTYPE1ÅCONSIDERÅNOÅPREVIOUSÅTEXT*TYPE0ÅLDAAÅ1,XÅTAKEÅAÅCHARACTERÅFROMÅTHEÅBUFFERÅINXÅTAKEÅTHEÅNEXTÅCHARACTERÅPOSITIONÅSTXÅPOINTÅANDÅRESETÅTHEÅPOINTERÅJSRÅPRINCÅPRINTÅTHEÅCHARACTERÅONÅTHEÅCONSOLEÅLDXÅPOINTÅIFÅTHEÅENDÅPOINTTYPE1ÅCPXÅHEREÅHASÅBEENÅREACHEDÅBNEÅTYPE0ÅTHENÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURN*TYPE2ÅJSRÅLNFWDÅGOÅ(ARG)ÅLINESÅFORWARDÅSTXÅLINMKÅMARKÅTHEÅENDÅADDRESSÅLDXÅTHEREÅBEGINNINGÅATÅTHEÅENDÅOFÅTHEÅTEXTÅGAPÅBRAÅTYPE4ÅCONSIDERÅNOÅFOLLOWINGÅTEXT*TYPE3ÅLDAAÅ1,XÅTAKEÅAÅCHARACTERÅFROMÅTHEÅBUFFERÅINXÅTAKEÅTHEÅNEXTÅCHARACTERÅPOSITIONÅSTXÅPOINTÅANDÅSETÅTHEÅPOINTERÅJSRÅPRINCÅPRINTÅTHEÅCHARACTERÅONÅTHEÅCONSOLEÅLDXÅPOINTÅIFÅTHEÅENDÅPOINTTYPE4ÅCPXÅLINMKÅHASÅBEENÅREACHEDÅBNEÅTYPE3ÅTHENÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURNÅPAGE*à*COMMANDÅACTIONÅSUBROUTINEÅVERIFY**IFÅTHEÅARGUMENTÅSIGNÅISÅPOSITIVE,ÅSETSÅTHEÅAUTOMATICÅVERIFICATIONÅOF*CHANGESÅANDÅVERIFIESÅ(COMMANDÅSTRINGÅ"0TT")ÅTHEÅCURRENTÅLINE.**IFÅTHEÅARGUMENTÅSIGNÅISÅNEGATIVEÅ(ARGUMENTÅ0ÅORÅLESS),ÅTURNSÅOFFÅTHE*AUTOMATICÅVERIFICATIONÅOFÅCHANGES.ÅNOÅVERIFICATIONÅOFÅTHEÅCURRENT*LINEÅISÅPERFORMED.*VERFYÅLDAÅAÅARSGNÅGETÅTHEÅARGUMENT'SÅSIGNÅSTAÅAÅVFLAGÅANDÅSAVEÅITÅINÅTHEÅFLAGÅLOCATIONVERFCÅLDAÅAÅVFLAGÅSETÅTHEÅCONDITIONÅCODESÅFORÅENTRYÅHEREÅBMIÅVERXTÅIFÅNEGATIVE,ÅNOÅACTIONÅLDXÅ#1ÅELSEÅDEFINEÅANÅARGUMENTÅOFÅ1ÅSTXÅARGÅANDÅSAVEÅITÅLDAÅAÅ#-1ÅSETÅTHEÅSIGNÅNEGATIVEÅSTAÅAÅARSGNÅANDÅSAVEÅITÅJSRÅTYPEÅDOÅTHEÅ"0T"ÅCLRÅARSGNÅSETÅTHEÅSIGNÅPOSITIVEÅJSRÅTYPEÅDOÅTHEÅ"T"VERXTÅRTSÅANDÅRETURNÅTOÅCALLER***à*COMMANDÅACTIONÅSUBROUTINEÅBEGINREPEAT**PUSHESÅDOWNÅARGÅANDÅSTRNGÅONÅTHEÅSTACK,ÅBEGINNINGÅAÅREPEATÅCYCLE.*THEÅSTACKÅHEIGHTÅISÅCHECKEDÅFORÅOVERFLOWÅ(NESTEDÅTOOÅDEEP).*BGRPTÅSTSÅSTKPTÅPUTÅDOWNÅAÅCOPYÅOFÅTHEÅSTACKÅPOINTERÅLDAAÅSTKPTÅIFÅTHEÅSTACKÅHASÅREACHEDÅTHEÅ0ÅPAGEÅ(H=0)ÅBEQÅBGRP1ÅTHENÅREPORTÅNESTINGÅERROR,ÅELSE*ÅPULAÅREMOVEÅTHISÅROUTINE'SÅEXITÅSTAAÅSTKPTÅADDRESSÅANDÅSAVEÅITÅPULAÅINÅTHEÅSTACKÅFIDDLINGÅLOCATIONÅSTAAÅSTKPT+1ÅFORÅLATERÅUSE*BGRP0ÅLDAAÅSTRNG+1ÅGETÅSTRNG(L)ÅPSHAÅANDÅPUSHÅITÅONÅTHEÅSTACKÅLDAAÅSTRNGÅGETÅSTRNG(H)ÅPSHAÅANDÅPUSHÅITÅONÅTHEÅSTACKÅLDAAÅARG+1ÅGETÅARG(L)ÅPSHAÅANDÅPUSHÅITÅONÅTHEÅSTACKÅLDAAÅARGÅGETÅARG(H)ÅPSHAÅANDÅPUSHÅITÅONÅTHEÅSTACKÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅLDXÅSTKPTÅPREPAREÅFORÅSUBROUTINEÅEXITÅJMPÅ0,XÅPERFORMÅEFFECTIVEÅRTS,ÅRETURN*BGRP1ÅLDXÅ#NESEMÅSELECTÅ"NESTEDÅTOOÅDEEP"ÅMESSAGEÅJSRÅPRINSÅPRINTÅMESSAGEÅSTRINGÅSECÅFLAGÅFAILUREÅ(C=1)ÅRTSÅANDÅRETURNÅPAGE*à*COMMANDÅACTIONÅSUBROUTINEÅENDREPEAT**PULLSÅSTRNGÅANDÅARGÅOFFÅTHEÅSTACK,ÅCOMPLETINGÅAÅREPEATÅCYCLE.*IFÅARGÅDOESÅNOTÅDECREMENTÅTOÅ0,ÅSTRNGÅISÅRESETÅTOÅTHEÅREPEAT*ENTRYÅPOINT,ÅANDÅANOTHERÅCYCLEÅISÅPERFORMEDÅVIAÅBGRPT.*NDRPTÅPULAÅREMOVEÅTHISÅROUTINE'SÅEXITÅSTAAÅSTKPTÅADDRESSÅANDÅSAVEÅITÅPULAÅINÅTHEÅSTACKÅFIDDLINGÅLOCATIONÅSTAAÅSTKPT+1ÅFORÅLATERÅUSE*ÅPULAÅGETÅARG(H)ÅSTAAÅARGÅANDÅRESTOREÅITÅPULAÅGETÅARG(L)ÅSTAAÅARG+1ÅANDÅRESTOREÅITÅLDXÅARGÅIFÅTHEÅARGÅCOUNTÅISÅDEXÅNOTÅYETÅCOMPLETEÅBEQÅNDRP1ÅTHEN*ÅSTXÅARGÅSETÅTHEÅREMAININGÅCOUNTÅPULAÅGETÅSTRNG(H)ÅSTAAÅSTRNGÅANDÅRESTOREÅITÅPULAÅGETÅSTRNG(L)ÅSTAAÅSTRNG+1ÅANDÅRESTOREÅITÅJMPÅBGRP0ÅSTARTÅANOTHERÅREPEATÅCYCLE*USEÅTHISÅROUTINE'SÅFIDDLEDÅRETURN*NDRP1ÅPULAÅTAKEÅTHEÅNOWÅUSED-UPÅPULAÅCOPYÅOFÅSTRNGÅOFFÅTHEÅSTACKÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅLDXÅSTKPTÅPREPAREÅFORÅSUBROUTINEÅEXITÅJMPÅ0,XÅPERFORMÅEFFECTIVEÅRTS,ÅRETURNÅPAGE*à*COMMANDÅACTIONÅSUBROUTINEÅEXIT**EXITSÅFROMÅTHEÅCURRENTÅEDITÅFILE.ÇWRITESÅALLÅTEXTÅINÅTHEÅBUFFER*TOÅTHEÅOUTPUT,ÅTHENÅTRANSFERSÅALLÅREMAININGÅTEXTÅFROMÅTHEÅINPUT*FILEÅTOÅTHEÅOUTPUTÅFILE,ÇANDÅPERFORMSÅANÅEOFÅCLEANUP.**EXITÅBSRÅWRBUFÅWRITEÅTHEÅCURRENTÅBUFFERÅBSRÅRDBUFÅREADÅAÅNEWÅONEÅBCSÅEXIT1ÅWHILEÅNOTÅEOFÅBRAÅEXIT**WRBUFÅJSRÅBEGINÅMOVEÅALLÅTHEÅTEXTÅTOÅTHEÅENDÅOFÅTHEÅBUFFERÅLDXÅ#$7FFEÅDEFINEÅMAXIMUMÅNUMERICÅVALUEÅSTXÅARGÅARGUMENTÅCLRÅARSGNÅPOSITIVE*ÅJSRÅWRITEÅOUTPUTÅUPÅTOÅ32ÅKÅLINESÅBCCÅWRBF1**IFÅWRITEÅERROR,ÅCLOSEÅTHEÅFILESÅWITHOUTÅCHANGE*ÅJSRÅOTCLOSÅCLOSEÅTHEÅOUTPUTÅFILEÅJSRÅOTRELSÅANDÅRELEASEÅTHEÅIOCBÅJSRÅINCLOSÅCLOSEÅTHEÅINPUTÅFILEÅJSRÅINRELSÅANDÅRELEASEÅTHEÅINPUTÅIOCBÅSWIÅRE-ENTERÅMDOSÅFCBÅ.MDENT**WRBF1ÅLDXÅTHEREÅIFÅTHEÅBUFFERÅCPXÅBUFNDÅISÅNOWÅEMPTYÅBNEÅEXITÅTHENÅRTSÅRETURN*RDBUFÅCLRÅAÅSTARTÅWITHÅZEROÅSUBÅAÅEOFFLÅSUBTRACTÅEOFÅFLAGÅBCSÅRDRTNÅTOÅDEFINEÅCARRYÅFLAG*ÅLDXÅ#$7FFEÅDEFINEÅMAXIMUMÅNUMERICÅVALUEÅSTXÅARGÅARGUMENTÅCLRÅARSGNÅPOSITIVEÅJSRÅREADÅREADÅUPÅTOÅ32ÅKÅLINESÅORÅEOFRDRTNÅRTSÅANDÅRETURN*EXIT1ÅLDSÅEDSTKÅRESETÅENTRYÅSTACKÅPOINTERÅRTSÅANDÅEXITÅTOÅFILEÅROUTINESÅPAGE*à*MEDITÅSTARTÅPOINT,ÅINITIALIZATIONÅROUTINES**THEÅSTACKÅANDÅSTRNGÅAREÅINITIALIZED.Å(THEÅCOMMANDÅBUFFERÅISÅSETÅTOÅBE*EMPTY)ÇTHEÅTEXTÅBUFFERÅISÅLEFTÅASÅITÅIS.ÇIFÅTEXTÅWASÅINÅTHEÅBUFFER*ITÅWILLÅSTILLÅBEÅINÅTHEÅBUFFERÅAFTERÅAÅRESTARTÅOFÅMEDIT.ÇTHEÅTEXT*BUFFERÅISÅINITIALIZEDÅONLYÅATÅPROGRAMÅLOADÅTIME.*STARTÅNOPÅALLOWÅFORÅ6800ÅCPUÅSEIÅBUGÅ(MASKÅBEFOREÅTJ)ÅSEIÅMEDITÅMUSTÅRUNÅWITHÅINTERRUPTSÅOFF!Å(STACKÅINÅUSEÅASÅPOINTER)ÅLDSÅ#STACKÅSETÅUPÅTHEÅSUBROUTINEÅ&ÅREPEATÅSTACKÅLDAÅAÅ#-1ÅMARKÅINPUTÅFILEÅEMPTYÅSTAÅAÅEOFFLÅWITHÅEOFÅFLAGÅSTAÅAÅVFLAGÅTURNÅOFFÅAUTO.ÅVERIFYÅLDXÅCBUFP$ÅUSEÅMDOSÅCOMMANDÅBUFFERÅSTXÅIFNAMEÅTOÅPROCESSÅFILEÅNAMESÅLDXÅ#IFNAMEÅPROCESSÅTHEÅFIRSTÅFILEÅNAMEÅSWIÅFCBÅ.PFNAMÅTSTBÅIFÅSOURCEÅFILEÅNAMEÅISÅILLEGALÅBEQÅOPN1ÅTHENÅBMIÅOPN0ÅIFÅFILEÅNAMEÅWASÅFOUNDÅLDABÅ#$7ÅITÅWASÅANÅILLEGALÅTYPEÅSKIP2Å.ÅSOÅREPORTÅ"ILLEGALÅFILEÅNAME",ÅELSEOPN0ÅLDABÅ#$5ÅREPORTÅ"NAMEÅREQUIRED"ÅSWIÅFCBÅ.MDERRÅSWIÅFCBÅ.MDENT*ÅCOPYÅTHEÅINPUTÅNAMEÅTOÅTHEÅINPUTÅIOCBOPN1ÅLDXÅ#INMPLXÅMOVEÅNAMEÅFROMÅBUFFERÅTOÅIOCBÅLDAÅBÅ#11ÅSWIÅFCBÅ.MOVE*ÅCOPYÅTHEÅDRIVEÅNUMBERÅTOÅOUTPUTÅ&ÅDEFAULTÅNAMESÅLDAÅAÅBKCLUNÅSTAÅAÅOTCLUNÅSTAÅAÅDFCLUNÅBSRÅINRESVÅRESERVEÅINPUTÅIOCBÅSWIÅFCBÅ.MDENT*INRESVÅLDXÅ#INIOCBÅSWIÅFCBÅ.RESRVÅBCSÅIOERXT*INRE1ÅBSRÅINOPENÅOPENÅTHEÅINPUTÅFILEINRELSÅLDXÅ#INIOCBÅRELEASEÅTHEÅINPUTÅIOCBÅSWIÅFCBÅ.RELESÅBCCÅINREXTÅREPORTÅANYÅERRORSIOERXTÅCLRÅBÅREPORTÅUNIFIEDÅI/OÅERRORMDERXTÅSWIÅVIAÅMDOSÅERRORÅHANDLERÅFCBÅ.MDERRINREXTÅRTSÅPAGEINOPENÅSWIÅOPENÅTHEÅINPUTÅFILEÅFCBÅ.OPENÅLDXÅIFNAMEÅGETÅNAMEÅTERMINATORÅINÅAÅLDAÅAÅ0,XÅBCCÅINOP1ÅCHECKÅERRORÅTYPE**ÅINPUTÅFILEÅNOTÅOPENEDÅNORMALLY*ÅCMPÅBÅ#I$NONMÅIFÅNON-EXISTENTÅBNEÅIOERXTÅCMPÅAÅ#CRÅIFÅTERMINATORÅNOTÅ<CR>ÅBEQÅINOP2ÅLDXÅ#BKCLUNÅREPORTÅ"\0ÅDOESÅNOTÅEXIST"ÅLDAÅBÅ#6ÅBRAÅMDERXT**ÅNON-EXISTENT,ÅOPENÅNEWÅOUTPUTÅFILE*INOP2ÅLDXÅ#NEWFLÅWARNINGÅ"CREATINGÅNEWÅFILE"ÅJSRÅPRINSÅPRINTÅTHEÅSTRING*ÅLDXÅ#NXMPLXÅMOVEÅFROMÅINPUTÅTOÅOUTPUTÅIOCBÅLDAÅBÅ#11ÅSWIÅFCBÅ.MOVEÅBRAÅOTRESVÅRESERVEÅ&ÅOPENÅOUTPUT**ÅINPUTÅFILEÅOPENEDÅNORMALLY.*ÅCHECKÅFORÅTHEÅPRESENCEÅOFÅAÅSECONDÅFILEÅNAME*INOP1ÅCLRÅEOFFLÅMARKÅFILEÅOPENÅFORÅINPUTÅCMPÅAÅ#CRÅIFÅTERMINATORÅ<CR>ÅBEQÅINOP4ÅUSEÅDEFAULTÅNAMEÅCMPÅAÅ#',ÅIFÅNOTÅCOMMAÅBEQÅINOP3FNERXTÅLDAÅBÅ#7ÅEXITÅ"ILLEGALÅFILEÅNAME"ÅBRAÅMDERXTÅPAGE*ÅSECONDÅFILEÅNAMEÅTOÅPROCESS*INOP3ÅLDXÅ#NXMPLXÅSETÅUPÅINPUTÅNAMEÅASÅDEFAULTÅLDAÅBÅ#11ÅSWIÅFCBÅ.MOVEÅLDXÅ#OTCLUNÅSTXÅIFNAME+2ÅLDXÅ#IFNAMEÅGETÅINPUTÅNAMEÅSWIÅFCBÅ.PFNAMÅBITÅBÅ#7ÅBNEÅFNERXTÅCMPÅAÅ#CRÅIFÅTERMINATORÅWASÅ<CR>ÅBNEÅFNERXTÅBSRÅOTRESVÅRESERVEÅTHEÅOUTPUTÅIOCB**ÅCLOSEÅTHEÅINPUTÅFILE*INCLOSÅLDXÅ#INIOCBÅSWIÅFCBÅ.CLOSEÅBCSÅIOERXTÅRTS*ÅRESERVEÅTHEÅOUTPUTÅIOCBOTRESVÅLDXÅ#OTIOCBÅSWIÅFCBÅ.RESRVÅBCSÅIOERXTÅBSRÅOTOPENÅOPENÅTHEÅFILEOTRELSÅLDXÅ#OTIOCBÅONÅRETURN,ÅRELEASEÅTHEÅIOCBÅSWIÅFCBÅ.RELESÅBCSÅIOERXTÅRTSÅANDÅRETURNÅTOÅCALLER*ÅOPENÅTHEÅFILEOTOPENÅSWIÅFCBÅ.OPENÅBCSÅIOERXTÅBSRÅEDITÅGOÅDOÅTHEÅJOBOTCLOSÅLDXÅ#OTIOCBÅCLOSEÅTHEÅOUTPUTÅFILEÅSWIÅFCBÅ.CLOSEÅBCSÅIOERXTÅREPORTÅERRORSÅRTSÅANDÅRETURNÅTOÅCALLERÅPAGE*ÅONEÅFILEÅNAMEÅONLY.*ÅOPENÅSCRATCH.SAÅFORÅOUTPUT*INOP4ÅBSRÅOTRESVÅRESERVEÅTHEÅOUTPUTÅBSRÅINCLOSÅCLOSEÅTHEÅINPUTÅJSRÅINRELSÅRELEASEÅTHEÅINPUT**ÅRESTOREÅTHEÅINPUTÅNAME*ÅLDXÅ#INRPLXÅLDAÅBÅ#11ÅCOPYÅTHEÅINPUTÅNAMEÅAGAINÅSWIÅFCBÅ.MOVEÅLDXÅ#INCLUNÅLDAÅBÅ#16ÅDELETEÅDIRECTORYÅENTRYÅSWIÅFCBÅ.DIRSMÅBCCÅOTRE4ÅLDAÅBÅ#$1CÅREPORTÅ"FILEÅISÅDELETEÅPROTECTED"ÅBRAÅOTRE3ÅANDÅEXITÅWITHOUTÅCHANGINGÅNAMEÅOFÅOUPUTÅFILE*OTRE4ÅLDXÅ#OTMPLXÅLDAÅBÅ#11ÅSWIÅFCBÅ.MOVEÅLDXÅ#CHGPLXÅCHANGEÅTHEÅOUTPUTÅFILEÅNAMEÅLDAÅBÅ#1ÅCHANGEÅNAMEÅFUNCTIONÅSWIÅFCBÅ.CHANGÅBCCÅOTRE5ÅLDAÅBÅ#$1AÅREPORTÅ"DUPLICATEÅFILEÅNAME"OTRE3ÅSWIÅFCBÅ.MDERROTRE5ÅSWIÅRE-ENTERÅMDOSÅFCBÅ.MDENTÅRMBÅ40ÅPATCHÅAREAÅPAGE*ÅINITIALIZEÅPAGEÅ0ÅMEMORY*EDITÅLDXÅ#BFBGNÅSETÅTEXTÅBEGINÅPOINTERÅSTXÅDOTÅSETÅUPÅMEMORYÅVARIABLESÅSTXÅEQULSÅSTXÅMARKÅSTXÅHEREÅSTXÅBUFSTÅLDXÅENDSY$ÅSETÅTEXTÅENDÅDEXÅALLOWÅGUARDÅSPACEÅSTXÅTHEREÅSTXÅBUFNDÅLDXÅ#CMBGNÅSETÅUPÅCOMMANDÅBUFFERÅSTXÅCMDSTÅLDXÅ#CMEND-11ÅSETÅWARNINGÅPOINTÅSTXÅCMBELÅLDXÅ#CMENDÅSETÅENDÅSTXÅCMDND*ÅLDAAÅ#'@ÅDEFINEÅINITIALÅVALUEÅSTAAÅPROMCÅFORÅTHEÅPROMPTÅCHARACTERÅSTSÅEDSTKÅSAVEÅENTRYÅSTACKÅPOINTERSTAR0ÅLDXÅ#STRMSÅSELECTÅPROGRAMÅSTART-UPÅMESSAGESTAR1ÅJSRÅPRINSÅPRINTÅTHEÅMESSAGEÅSTRING*PRMPTÅLDSÅEDSTKÅRESETÅTHEÅSTACK,ÅINÅCASEÅOFÅAÅCRASHÅEXITÅLDXÅCMDSTÅSELECTÅTHEÅSTARTÅOFÅTHEÅCOMMANDÅBUFFERÅSTXÅSTRNGÅFORÅTHEÅSTRINGÅPOINTERÅ(COMMANDÅBUFFERÅEMPTY)ÅLDAAÅPROMCÅSELECTÅTHEÅPROMPTÅCHARACTERÅJSRÅPRINCÅPRINTÅTHEÅUSERÅPROMPTÅJSRÅBLDCMÅBUILDÅAÅCOMMANDÅBUFFERÅUNTILÅTERMINATIONÅLDAAÅ#CRÅTERMINATEÅTHEÅCOMMANDÅWITHÅJSRÅPRINCÅ<CR><LF>Å(EXPANDEDÅ<CR>)ÅJSRÅCKCMDÅCHECKÅTHEÅCOMMANDÅSTRINGÅFORÅCORRECTÅSYNTAXÅLDXÅCMDSTÅSTARTÅATÅTHEÅBEGINNINGÅOFÅSTXÅSTRNGÅTHEÅSPECIFIEDÅCOMMANDSÅPAGE*à*COMMANDÅSTRINGÅSWITCHÅDECODER**PICKSÅAÅSINGLEÅCHARACTERÅOFFÅTHEÅINPUTÅCOMMANDÅSTRING,ÅUSINGÅITÅASÅA*COMMANDÅSWITCHÅVALUEÅFORÅTHEÅAPPROPRIATEÅFUNCTIONÅSUBROUTINE*DECOSÅBSRÅDECODÅGETÅAÅCOMMANDÅCHARACTERÅ&ÅENTRYÅADDRESSÅLDXÅ0,XÅSELECTÅTHEÅENTRYÅADDRESSÅDEFINEDÅBYÅTHISÅCHARACTERÅJSRÅ0,XÅCALLÅTHEÅCOMMANDÅACTIONÅSUBROUTINEÅBCCÅDECOSÅIFÅSUCCESS,ÅDECODEÅTHEÅNEXTÅCOMMANDDECS1ÅLDXÅ#CRONLÅSELECTÅ<CR><LF>ÅFORÅNEWÅPROMPTÅBRAÅSTAR1ÅDELETEÅTHEÅCOMMANDÅSTRING,ÅRE-ISSUEÅPROMPT*****************************************************************************à*COMMANDÅSTRINGÅACTIONÅTERMINATION**RECOGNIZESÅANÅ<ESC><ESC>ÅPAIRÅWHICHÅWASÅNOTÅANÅEXPLICITÅTEXTÅSTRING*TERMINATOR.ÇTHISÅDEFINESÅTHEÅENDÅOFÅTHEÅCURRENTÅCOMMANDÅSTRING.**ESCEXÅLDXÅSTRNGÅIFÅTHEÅNEXTÅCOMMANDÅCHARACTERÅCMPAÅ1,XÅISÅALSOÅ<ESC>ÅBEQÅPRMPTÅTHENÅDELETEÅCOMMANDÅSTRINGÅ&ÅRE-ISSUEÅPROMPT**THISÅENTRYÅISÅUSEDÅTOÅSKIPÅOVERÅASCIIÅSPACESÅEMBEDDEDÅINÅTHEÅCOMMANDÅSTRING*SPCEXÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅRETURNÅ(IGNOREÅSINGLEÅ<ESC>)***DECODÅJSRÅPARSEÅPREPAREÅARGUMENTS,ÅGETÅAÅCOMMANDÅCHARACTERÅBCSÅDECFLÅIFÅARGUMENTSÅAREÅLEGAL,ÅTHENÅLDXÅ#CMDADÅSELECTÅTHEÅCOMMANDÅINTERPETATIONÅTABLEDECO1ÅCMPAÅ2,XÅIFÅTHISÅCHARACTERÅMATCHESÅBNEÅDECO2ÅTHENÅRTSÅRETURN,ÅELSE*DECO2ÅINXÅSTEPÅOVERÅTHEÅADDRESSÅINXÅFORÅTHISÅFUNCTIONÅINXÅANDÅTHEÅCOMMANDÅCHARACTERÅPROTOTYPEÅCPXÅ#CMDLMÅIFÅTHEÅTABLEÅRANÅOUTÅBNEÅDECO1ÅTHEN*DECFLÅLDXÅ#CMERRÅSELECTÅ"COMMANDÅERROR"ÅMESSAGEÅ(<?><CR><LF>)ÅBRAÅSTAR1ÅDELETEÅTHEÅCOMMANDÅSTRING,ÅRE-ISSUEÅPROMPTÅPAGECMDADÅFDBÅSERCFÅ"SEARCH"ÅCOMMANDÅENTRYÅFCBÅ'SÅFDBÅSFILEÅ"SEARCHÅFILE"ÅENTRYÅFCBÅ'NÅFDBÅINSRTÅ"INSERT"ÅCOMMANDÅENTRYÅFCBÅ'IÅFDBÅDELETÅ"DELETE"ÅCOMMANDÅENTRYÅFCBÅ'DÅFDBÅCHNGFÅ"CHANGE"ÅCOMMANDÅENTRYÅFCBÅ'CÅFDBÅBEGINÅ"BEGINNING"ÅCOMMANDÅENTRYÅFCBÅ'BÅFDBÅJUMPÅ"JUMP"ÅCOMMANDÅENTRYÅFCBÅ'MÅFDBÅADVNCÅ"ADVANCE"ÅCOMMANDÅENTRYÅFCBÅ'LÅFDBÅKILLÅ"KILL"ÅCOMMANDÅENTRYÅFCBÅ'KÅFDBÅAPPNDÅ"APPEND"ÅCOMMANDÅENTRYÅFCBÅ'AÅFDBÅREADÅ"READ"ÅCOMMANDÅENTRYÅFCBÅ'RÅFDBÅWRITEÅ"WRITE"ÅCOMMANDÅENTRYÅFCBÅ'PÅFDBÅTYPEÅ"TYPE"ÅCOMMANDÅENTRYÅFCBÅ'TÅFDBÅWHOLEÅ"CHANGEÅWHOLEÅBUFFER"ÅCOMMANDÅENTRYÅFCBÅ'HÅFDBÅVERFYÅ"VERIFY"ÅCOMMANDÅENTRYÅFCBÅ'VÅFDBÅEXITÅ"EXIT"ÅCOMMANDÅENTRYÅFCBÅ'EÅFDBÅBGRPTÅ"BEGINÅREPEAT"ÅCOMMANDÅENTRYÅFCBÅ'<ÅFDBÅNDRPTÅ"ENDÅREPEAT"ÅCOMMANDÅENTRYÅFCBÅ'>ÅFDBÅENDBFÅ"END"ÅCOMMANDÅENTRYÅFCBÅ'ZÅFDBÅSPCEXÅASCIIÅSPACEÅCOMMANDÅCHARACTERÅSKIPÅFCBÅSPÅ<SPC>ÅFDBÅSPCEXÅASCIIÅ<CR>ÅCOMMANDÅCHARACTERÅSKIPÅFCBÅCRÅFDBÅESCEXÅCOMMANDÅSTRINGÅTERMINATORÅENTRYÅFCBÅESÅ<ESC>CMDLMÅEQUÅ*ÅENDÅOFÅTHEÅCOMMANDÅDESPATCHÅTABLEÅPAGE*à*COMMANDÅSTRINGÅPARSEÅROUTINE**STRIPSÅANDÅCONVERTSÅVALIDÅPREFIXÅARGUMENTS.ÇPASSESÅAÅPRESUMED*COMMANDÅCHARACTERÅBACKÅTOÅDECODÅFORÅSWITCHÅCONTROL.*PARSEÅBSRÅGETCHÅGETÅAÅCOMMANDÅSTRINGÅCHARACTER****à*COMMANDÅSTRINGÅPREFIXÅARGUMENTÅANALYZER**PERFORMSÅSYNTAXÅANALYSISÅONÅVALIDÅPREFIXÅARGUMENTS,ÅWITHÅCALLÅTO*PERFORMÅTHEÅREQUIREDÅSETUPÅLIMITS.ÇDOESÅNUMERICÅCONVERSIONÅ&*LIMITÅCHECKÅ(32ÅKÅMAX)ÅFORÅNUMERICÅARGUMENTS.*ARANLÅCLRÅARSGNÅASSUMEÅAÅPOSITIVEÅNUMBERÅCMPAÅ#'-ÅIFÅFIRSTÅCHARÅISÅASCIIÅMINUSÅBNEÅNUMPKÅTHENÅLDAAÅ#$FFÅSETÅAÅMINUSÅVALUEÅSTAAÅARSGNÅINÅTHEÅSIGNÅBSRÅGETCHÅGETÅANOTHERÅCOMMANDÅSTRINGÅCHARACTER***à*NUMERICÅCONVERSIONÅROUTINE**ACCEPTSÅNUMERICÅINPUT,ÅCONVERTINGÅITÅTOÅBINARYÅINÅNUMLÅ&ÅNUMH.*ANYÅNON-NUMERICÅCHARACTERÅTERMINATESÅCONVERSION.ÇTHEÅNON-*NUMERICÅCHARACTERÅISÅRETURNEDÅINÅA,ÅUNCHANGED.ÇIFÅTHEÅCONVERTED*VALUEÅEXCEEDSÅ32ÅK,ÅCONVERSIONÅISÅTERMINATED,Å&ÅFAILUREÅISÅSET.*NUMPKÅCLRBÅINITIALIZEÅBOTHÅSTABÅNUMLÅLOWÅ&ÅHIGHÅBYTESÅSTABÅNUMHÅOFÅTHEÅCONVERSIONÅLOCATIONÅDECBÅDEFINEÅFLAGÅVALUEÅ=Å$FFÅSTABÅNUMBRÅASSUMEÅDEFAULTÅVALUEÅ(SETÅFLAG)*NUMP1ÅCMPAÅ#'0ÅIFÅTHEÅCHARACTERÅISÅBCSÅNUMNDÅLESSÅTHANÅ0,ÅEXITÅCMPAÅ#'9ÅIFÅTHEÅCHARACTERÅISÅBHIÅNUMNDÅGREATERÅTHANÅ9,ÅEXIT*ÅSUBAÅ#'0ÅCONVERTÅTOÅBINARYÅSTAAÅNUMBRÅANDÅSAVEÅTHEÅNUMBERÅLDAAÅNUMLÅGETÅTHEÅEXISTINGÅLDABÅNUMHÅNUMBER,ÅANDÅPAGE*MULTIPLYÅITÅBYÅ10*ÅASLAÅROLBÅXÅ2ÅASLAÅROLBÅXÅ2ÅADDAÅNUMLÅADCBÅNUMHÅ+1ÅASLAÅROLBÅ((X*2*2)+X)*2Å=Å10X*ÅADDAÅNUMBRÅADDÅTHEÅNEWÅNUMBERÅ(INÅUNITSÅPOSITION)ÅADCBÅ#$0ÅWITHÅCARRYÅIFÅNEEDEDÅSTAAÅNUMLÅTHEÅNUMBERÅISÅNOWÅSTABÅNUMHÅPACKEDÅIN*ÅBMIÅNUMFLÅIFÅNOÅOVERFLOWÅ(.GT.Å32ÅK),ÅTHENÅBSRÅGETCHÅGETÅANOTHERÅCOMMANDÅCHARACTERÅBRAÅNUMP1ÅANDÅCONTINUE*NUMFLÅSECÅFLAGÅFAILUREÅ(C=1)ÅRTSÅANDÅRETURN*NUMNDÅLDABÅNUMBRÅIFÅDEFAULTÅVALUEÅ(NOÅNUMBERÅTYPED)ÅBPLÅNUMN1ÅTHENÅLDXÅ#$1ÅFORCEÅDEFAULTÅVALUEÅ=Å1ÅSTXÅNUMHÅASÅARGUMENTÅVALUENUMN1ÅLDXÅNUMHÅIFÅANÅARGUMENTÅOFÅ0ÅBNEÅNUMN2ÅWASÅDELIBERATELYÅTYPED,ÅTHENÅLDABÅ#$FFÅDEFINEÅTHEÅARGUMENTÅSIGNÅSTABÅARSGNÅTOÅBEÅNEGATIVEÅ(BACKÅTOÅSTARTÅOFÅTHISÅLINE)NUMN2ÅLDABÅARSGNÅIFÅAÅ-ÅSIGNÅISÅPRESENTÅBPLÅNUMN3ÅTHENÅLDXÅNUMHÅINCREASEÅTHEÅINXÅARGUMENTÅVALUEÅSTXÅNUMHÅBYÅONEÅCOUNTÅBMIÅNUMFLÅIFÅNOÅOVERFLOWÅ(.GT.Å32ÅK),ÅTHENNUMN3ÅCLCÅFLAGÅSUCCESSÅ(C=0)ÅRTSÅANDÅRETURNÅPAGE*à*GETÅCOMMANDÅSTRINGÅCHARACTERÅSUBROUTINE**GETSÅAÅCHARACTERÅFROMÅTHEÅCOMMANDÅBUFFER,ÅANDÅUSESÅITÅUPÅON*THEÅPOINTERÅSTRNG.ÇUSEDÅDURINGÅCOMMANDÅINTERPETATION.*NOTEÅTHATÅSTRNGÅWASÅSETÅUPÅTOÅBEÅUSEDÅBYÅSP,ÅXÅREQUIRESÅ+1*GETCHÅLDXÅSTRNGÅUSEÅTHEÅSTRNGÅPOINTERÅLDAAÅ1,XÅTOÅGETÅAÅCHARACTERÅINXÅUSEÅUPÅTHISÅCHARACTERÅSTXÅSTRNGÅONÅTHEÅPOINTERÅRTSÅANDÅRETURN**à*COMMANDÅSYNTAXÅCHECKÅROUTINE**CHECKSÅAÅCOMMANDÅSTRINGÅFORÅVALIDITYÅOFÅCOMMANDSÅ&ÅARGUMENTS.*AÅFAULTYÅCOMMANDÅSTRINGÅISÅABORTEDÅHERE.*CKCMDÅLDXÅCMDSTÅSTARTÅATÅTHEÅBEGINNINGÅSTXÅSTRNGÅOFÅTHISÅCOMMANDÅSTRINGÅCLRÅBKCTRÅASSUMEÅ"<>"ÅPAIRSÅMATCH*CKCM1ÅJSRÅDECODÅGETÅAÅCOMMANDÅCHARACTERÅ&ÅCHECKÅARGUMENTSÅCMPAÅ#'<ÅIFÅITÅISÅAÅBEGINÅBRACKETÅBNEÅCKCM2ÅTHENÅINCÅBKCTRÅCOUNTÅUPÅONEÅHALFÅOFÅAÅPAIRCKCM2ÅCMPAÅ#'>ÅIFÅITÅISÅANÅENDÅBRACKETÅBNEÅCKCM3ÅTHENÅDECÅBKCTRÅCOUNTÅDOWNÅONEÅHALFÅOFÅAÅPAIRCKCM3ÅCMPAÅ#'CÅIFÅTHEÅCOMMANDÅWASÅ"CHANGE"ÅBEQÅCONS2ÅCONSUMEÅTWOÅSTRINGS,ÅELSEÅCMPÅAÅ#'HÅIFÅTHEÅCOMMANDÅWASÅ"CHANGEÅWHOLEÅBUFFER"ÅBEQÅCONS2ÅCONSUMEÅTWOÅSTRINGS,ÅELSEÅCMPAÅ#'SÅIFÅTHEÅCOMMANDÅWASÅ"SEARCH"ÅBEQÅCONS1ÅCONSUMEÅONEÅSTRING,ÅELSEÅCMPAÅ#'IÅIFÅTHEÅCOMMANDÅWASÅ"INSERT"ÅBEQÅCONS1ÅCONSUMEÅONEÅSTRING,ÅELSEÅCMPÅAÅ#'NÅIFÅTHEÅCOMMANDÅWASÅ"SEARCHÅFILE"ÅBEQÅCONS1ÅCONSUMEÅONEÅSTRINGÅCMPAÅ#ESÅIFÅITÅISÅANÅ<ESC>ÅBNEÅCKCM1ÅTHENÅLDXÅSTRNGÅIFÅTHEÅNEXTÅCHARACTERÅINÅTHEÅCOMMANDÅSTRINGÅCMPAÅ1,XÅISÅALSOÅ<ESC>Å(COMMANDÅTERMINATION)ÅBNEÅCKCM1ÅTHENÅTSTÅBKCTRÅIFÅALLÅ"<>"ÅPAIRSÅMATCHEDÅBNEÅCKCM4ÅTHENÅRTSÅRETURN,ÅCOMMANDÅSTRINGÅISÅVALID*CKCM4ÅLDXÅ#BRKERÅSELECTÅ"<>"ÅERROR!ÅMESSAGEÅJMPÅSTAR1ÅDELETEÅTHEÅ(FAULTY)ÅCOMMANDÅSTRING,ÅRE-ISSUEÅPROMPTÅPAGE*à*TEXTÅSTRINGÅCONSUMINGÅPROCESS**CONSUMESÅTEXTÅSTRINGSÅTOÅ&ÅINCLUDINGÅ<ESC>*ENTRYÅATÅCONS2ÅCONSUMESÅTWOÅSTRINGS*ENTRYÅATÅCONS1ÅCONSUMESÅONEÅSTRING*CONS2ÅBSRÅGETCHÅCONSUMEÅAÅCHARACTERÅFROMÅTHEÅCOMMANDÅSTRINGÅCMPAÅ#ESÅIFÅITÅWASÅNOTÅANÅ<ESC>ÅBNEÅCONS2ÅCONSUMEÅANOTHER,ÅELSE*CONS1ÅBSRÅGETCHÅCONSUMEÅAÅCHARACTERÅFROMÅTHEÅCOMMANDÅSTRINGÅCMPAÅ#ESÅIFÅITÅWASÅNOTÅANÅ<ESC>ÅBNEÅCONS1ÅCONSUMEÅANOTHER,ÅELSE*ÅBRAÅCKCM1ÅTEXTÅSTRINGSÅCONSUMED,ÅCHECKÅNEXTÅCOMMAND****à*COMMANDÅBUFFERÅBUILDINGÅROUTINE**BUILDSÅAÅCOMMANDÅSTRINGÅINÅTHEÅCOMMANDÅBUFFER,ÅACCEPTINGÅINPUT*FROMÅTHEÅKEYBOARD.ÇKEYBOARDÅUSERÅERRORÅCORRECTIONÅFACILITIESÅARE*HERE.ÇWARNINGÅISÅGIVENÅOFÅCOMMANDÅBUFFERÅALMOSTÅFULLÅ&ÅFULL.*BLDCMÅJSRÅINCHRÅGETÅANÅINPUTÅCHARACTERÅBSRÅDOCHRÅOPERATEÅONÅTHEÅCOMMANDÅBUFFERÅBCSÅBLDCMÅIFÅTHISÅWASÅ<ESC>,ÅTHEN*BLDC2ÅJSRÅINCHRÅGETÅANÅINPUTÅCHARACTERÅBSRÅDOCHRÅOPERATEÅONÅTHEÅCOMMANDÅBUFFERÅBCSÅBLDCMÅIFÅTHISÅWASÅ<ESC>,ÅTHEN*ÅSTAAÅ1,XÅADDÅ2ÅMOREÅ<ESC>ÅCHARACTERSÅSTAAÅ2,XÅ(MAKEÅSUREÅDECODERÅFINDSÅ<ESC>ÅTERMINATOR)ÅRTSÅRETURN,ÅCOMMANDÅISÅDONEÅPAGEDOCHRÅLDXÅSTRNGÅPOINTÅINTOÅTHEÅCOMMANDÅBUFFERÅCMPAÅ#CNTHÅIFÅTHISÅCHARACTERÅISÅCONTROLÅHÅBNEÅDOCH1ÅTHENÅCPXÅCMDSTÅIFÅTHEREÅISÅAÅPREVIOUSÅCHARACTERÅBEQÅDOCHPÅTHENÅLDAAÅ0,XÅGETÅTHEÅPREVIOUSÅCHARACTERÅDEXÅDELETEÅITÅFROMÅTHEÅSTXÅSTRNGÅCOMMANDÅBUFFERÅJSRÅPRINCÅECHOÅITÅBRAÅDOCH6ÅANDÅCARRYÅONDOCH1ÅCMPAÅ#CNTXÅIFÅTHISÅCHARACTERÅISÅCONTROLÅXÅBNEÅDOCH2ÅTHENDOCHPÅLDXÅ#CRONLÅSELECTÅ<CR><LF>ÅFORÅPROMPTÅJMPÅSTAR1ÅWIPEÅTHISÅCOMMANDÅSTRING,ÅRE-ISSUEÅPROMPTDOCH2ÅCMPAÅ#RUBÅIFÅTHISÅCHARACTERÅISÅAÅRUBOUTÅBNEÅDOCH3ÅTHENÅCPXÅCMDSTÅIFÅTHEREÅISÅAÅPREVIOUSÅCHARACTERÅBEQÅDOCHPÅTHENÅDEXÅDELETEÅITÅSTXÅSTRNGÅFROMÅTHEÅCOMMANDÅBUFFERÅLDXÅ#BAKSPÅSELECTÅTHEÅ"BACKSPACE"ÅFUNCTIONÅSTRINGÅJSRÅPRINSÅPERFORMÅAÅ<BS><SPC><BS>ÅSEQUENCEÅBRAÅDOCH6ÅANDÅCARRYÅONDOCH3ÅCMPAÅ#CNTPÅIFÅTHISÅCHARACTERÅISÅCONTROLÅPÅBNEÅDOCH4ÅTHENÅJMPÅSTAR0ÅBAILÅOUTÅ&ÅRESTARTÅMEDITDOCH4ÅCPXÅCMBELÅIFÅDOWNÅTOÅ10ÅCHARSÅLEFTÅINÅCOMMANDÅBUFFERÅBNEÅDOCH5ÅTHENÅPSHAÅSAVEÅTHEÅCHARACTERÅONÅTHEÅSTACKÅLDXÅ#CMWRNÅSELECTÅ"10ÅCHARSÅLEFTÅINÅCOMMANDÅBUFFER"ÅMESSAGEÅJSRÅPRINSÅPRINTÅITÅPULAÅRESTOREÅTHISÅCHARACTERÅFROMÅTHEÅSTACKÅBRAÅDOCH7ÅENTERÅITÅINÅTHEÅBUFFERÅ&ÅTESTÅFORÅ<ESC>DOCH5ÅCPXÅCMDNDÅIFÅTHEÅENDÅOFÅTHEÅCOMMANDÅBUFFERÅHASÅBEENÅREACHEDÅBNEÅDOCH7ÅTHENÅLDXÅ#CMFULÅSELECTÅTHEÅ"COMMANDÅBUFFERÅFULL"ÅMESSAGEÅJSRÅPRINSÅPRINTÅITDOCH6ÅSECÅSIGNALÅ"NOTÅANÅ<ESC>"ÅRTSÅANDÅCARRYÅONÅ(CHARACTERÅDIDÅNOTÅGOÅIN!)ÅDOCH7ÅLDXÅSTRNGÅPOINTÅINTOÅTHEÅCOMMANDÅBUFFERÅSTAAÅ1,XÅPUTÅTHEÅCHARACTERÅINÅTHEÅCOMMANDÅBUFFERÅINXÅTAKEÅTHEÅNEXTÅCOMMANDÅBUFFERÅPOSITIONÅSTXÅSTRNGÅFORÅTHEÅNEXTÅCHARACTERÅCMPAÅ#ESÅIFÅTHISÅCHARACTERÅWASÅ<ESC>ÅBNEÅDOCH6ÅTHENÅCLCÅSIGNALÅ"THISÅWASÅANÅ<ESC>"ÅRTSÅRETURNÅTOÅBLDCMÅ<ESC>ÅDECODEÅSEQUENCEÅPAGE*à*STANDARDÅMEDITÅI/OÅFILTERSÅ&ÅHANDLERS**à*SERVICEÅSUBROUTINEÅINPUTCHARACTER**LOOKSÅTOÅSEEÅIFÅAÅCHARACTERÅISÅPRESENT.ÇIFÅAÅCHARACTERÅISÅPRESENT*ITÅISÅFILTERED.Å(<NUL>Å&Å<LF>ÅAREÅDISCARDED)ÇWHENÅANÅACCEPTABLE*CHARACTERÅISÅAVAILABLE,ÅITÅISÅRETURNED.ÇTHISÅROUTINEÅWILLÅNOT*RETURNÅUNTILÅAÅCHARACTERÅISÅAVAILABLE.ÇTHEÅCHARACTERÅISÅRETURNED*INÅACCUMULATORÅA.*INCHRÅJSRÅLOOKCÅIFÅTHEREÅISÅAÅKEYBOARDÅCHARACTERÅBCCÅINCHRÅTHENÅTSTAÅIFÅTHEÅCHARACTERÅWASÅAÅNULLÅBEQÅINCHRÅIGNOREÅITÅCMPAÅ#LFÅIFÅTHEÅCHARACTERÅWASÅ<LF>ÅBEQÅINCHRÅIGNOREÅITÅCMPAÅ#CNTHÅIFÅTHEÅCHARACTERÅWASÅCONTROLÅHÅBEQÅINCHXÅDOÅNOTÅECHOÅIT*ÅPSHAÅELSEÅSAVEÅAÅCOPYÅOFÅTHEÅCHARACTERÅBSRÅPRINCÅECHOÅTHEÅCHARACTERÅPULAÅRESTOREÅTHEÅCHARACTERINCHXÅRTSÅANDÅRETURNÅTHEÅCHARACTERÅPAGE**à*SERVICEÅSUBROUTINEÅPRINTCHARACTER**ACCEPTSÅAÅCHARACTERÅINÅACCUMULATORÅAÅFORÅOUTPUTÅONÅTHEÅCONSOLE*THEÅOUTPUTÅISÅFILTEREDÅ&ÅEXPANDED.Ç<ESC>ÅBECOMESÅ$,Å<SUB>ÅBECOMESÅ?*<CR>ÅISÅEXPANDEDÅTOÅ<CR><LF>(COUNT)<NUL>.*PRINCÅCMPAÅ#ESÅIFÅTHEÅCHARACTERÅISÅ<ESC>ÅBNEÅPRIN1ÅTHENÅLDAAÅ#'$ÅPRINTÅITÅASÅ$ÅBRAÅPRINTÅINSTEAD,ÅELSE*PRIN1ÅCMPAÅ#SBÅIFÅTHEÅCHARACTERÅISÅ<SUB>ÅBNEÅPRIN2ÅTHENÅLDAAÅ#'?ÅPRINTÅITÅASÅ?ÅBRAÅPRINTÅINSTEAD,ÅELSE*PRIN2ÅCMPAÅ#CRÅIFÅTHEÅCHARACTERÅISÅ<CR>ÅBNEÅPRINTÅTHENÅBSRÅPRINTÅPRINTÅ<CR>ÅLDAAÅ#LFÅDEFINEÅAÅ<LF>ÅBSRÅPRINTÅADDÅ<LF>ÅLDABÅNULCTÅGETÅTHEÅNUMBERÅOFÅNULLSÅREQUIREDÅBRAÅPRIN4ÅCONSIDERÅNULLSÅ=Å0Å(NONEÅREQUIRED)*PRIN3ÅCLRAÅDEFINEÅAÅNULLÅPSHBÅSAVEÅTHEÅNULLÅCOUNTÅBSRÅPRINTÅPRINTÅAÅNULLÅ(WAITÅFORÅTHEÅTERMINAL)ÅPULBÅRESTOREÅTHEÅNULLÅCOUNTPRIN4ÅSUBBÅ#$01ÅWHILEÅTHEÅNULLÅCOUNTÅBCCÅPRIN3ÅPRINTÅNULLSÅRTSÅTHENÅRETURN*PRINTÅJMPÅPUTCHÅVECTORÅTOÅTHEÅPRINTÅCHARACTERÅSUBROUTINE***à*SERVICEÅSUBROUTINEÅPRINTSTRING**PRINTSÅAÅSTRINGÅOFÅASCIIÅCHARACTERSÅPOINTEDÅTOÅBYÅREGISTERÅX*THEÅSTRINGÅMUSTÅTERMINATEÅWITHÅAÅBYTEÅVALUEÅOFÅ0Å(AÅNULL)*ALLÅREGISTERSÅMAYÅBEÅUSED*PRNS1ÅINXÅTAKEÅTHEÅNEXTÅCHARACTERÅSTXÅPOINTÅSETÅTHEÅPOINTERÅJSRÅPRINCÅPRINTÅTHEÅCHARACTERÅLDXÅPOINTÅGETÅTHEÅPOINTERPRINSÅLDAAÅ0,XÅGETÅAÅCHARACTERÅBNEÅPRNS1ÅIFÅNON-ZERO,ÅPRINTÅITÅRTSÅELSEÅRETURNÅPAGE*à*FIXEDÅMESSAGEÅSTRINGSÅUSEDÅWITHÅPRINS**ASCIIÅCHARACTERÅSTRINGS,ÅTERMINATEDÅWITHÅAÅBYTEÅOFÅ0.*FLEMSÅFCCÅ/FILEÅEND,ÅEDITÅCLOSED/ÅFCBÅCR,0*NEWFLÅFCBÅCRÅFCCÅ/CREATINGÅNEWÅFILE/ÅFCBÅCR,0*NRMMSÅFCCÅ/NOÅROOM/ÅFCBÅ0*SFLMSÅFCCÅ/SEARCHÅFAIL/ÅFCBÅ0*TOMANÅFCCÅ/TOOÅMANY/ÅFCBÅ0*NESEMÅFCCÅ/NESTEDÅTOOÅDEEP/ÅFCBÅ0*CHNGMÅFCCÅ/ÅCHANGE/ÅFCBÅ0*CMERRÅFCBÅ'?CRONLÅFCBÅCRÅ(EXPANDSÅTOÅ<CR><LF>)ÅFCBÅ0*BRKERÅFCCÅ/"<>"ÅERROR!/ÅFCBÅCRÅ(EXPANDSÅTOÅ<CR><LF>)ÅFCBÅ0*CMWRNÅFCCÅ/Å10ÅCHARSÅLEFTÅINÅCOMMANDÅBUFFER!/ÅFCBÅBELÅRINGÅTHEÅBELLÅFCBÅCRÅ(EXPANDSÅTOÅ<CR><LF>)ÅFCBÅ0*CMFULÅFCCÅ/COMMANDÅBUFFERÅFULL/ÅFCBÅBELÅRINGÅTHEÅBELLÅFCBÅCRÅ(EXPANDSÅTOÅ<CR><LF>)ÅFCBÅ0*BAKSPÅFCBÅCNTHÅFCBÅSPÅFCBÅCNTHÅFCBÅ0*STRMSÅFCBÅCRÅSTARTÅPROGRAMÅIDÅPROMPTÅONÅNEWÅLINEÅFCCÅ/6800ÅMACROÅEDITOR,ÅLEVELÅ2.2/ÅFCBÅCRÅ(EXPANDSÅTOÅ<CR><LF>)ÅFCCÅ/COPYRIGHTÅ(C)Å-Å1977ÅD.ÅHATCH/ÅFCBÅCRÅ(EXPANDSÅTOÅ<CR><LF>)ÅFCBÅ0ÅPAGE*ÅBACKUPÅFILEÅI/OÅCONTROLÅBLOCK*BKCLUNÅFCBÅ'0ÅDEFAULTÅDRIVEÅ0BKCNAMÅFCCÅ8,ÅBKCSUFÅFCCÅ2,SAÅDEFAULTÅSUFFIX*DFCLUNÅFCBÅ'0DFCNAMÅFCCÅ8,SCRATCHDFCSUFÅFCCÅ2,SA**ÅINPUTÅI/OÅCONTROLÅBLOCKÅ&ÅBUFFER*INIOCBÅFCBÅ0ÅSTATUSÅBYTEÅFCBÅ$80ÅINPUTÅTRANSFERÅUPDATEÅEXISTINGÅFILEINCDBPÅFDBÅ0ÅRECORDÅBUFFERÅPOINTERINCDBSÅFDBÅ0ÅRECORDÅBUFFERÅSTARTINCDBEÅFDBÅ0ÅRECORDÅBUFFERÅENDINCGDWÅFCCÅ2,DKÅDEFAULTÅDISKINCLUNÅFCBÅ'0ÅDEFAULTÅDRIVEÅ0ÅRMBÅ8ÅFILEÅNAMEÅFCCÅ2,SAÅDEFAULTÅSUFFIXÅFDBÅ0ÅRIBÅSECTORINCFDFÅFCBÅ5ÅDESCRIPTORÅFLAGSÅRMBÅ5ÅFDBÅ0ÅSECTORÅBUFFERÅPOINTERINCSBSÅFDBÅINSBSÅSECTORÅBUFFERÅSTARTINCSBEÅFDBÅINSBS+127ÅSECTORÅBUFFERÅENDÅRMBÅ2INSBSÅRMBÅ128ÅSECTORÅBUFFER**ÅOUTPUTÅI/OÅCONTROLÅBLOCKÅ&ÅBUFFER*OTIOCBÅFCBÅ0ÅSTATUSÅBYTEÅFCBÅ$42ÅOUTPUTÅNEWÅTRUNCATEDÅFILEOTCDBPÅFDBÅ0ÅRECORÅBUFFERÅPOINTEROTCDBSÅFDBÅ0ÅRECORDÅBUFFERÅSTARTOTCDBEÅFDBÅ0ÅRECORDÅBUFFERÅENDOTCGDWÅFCCÅ2,DKÅDEFAULTÅTOÅDISKOTCLUNÅFCBÅ'0ÅDEFAULTÅDRIVEÅ0OTCNAMÅFCCÅ8,SCRATCHÅDEFAULTÅNAMEOTCSUFÅFCCÅ2,SAÅDEFAULTÅSUFFIXÅFDBÅ0ÅRIBÅSECTOROTCFDFÅFCBÅ5ÅASCIIÅRMBÅ5OTCSBPÅFDBÅ0ÅSECTORÅBUFFERÅPOINTEROTCSBSÅFDBÅOTSBSÅSECTORÅBUFFERÅSTARTOTCSBEÅFDBÅOTSBS+127ÅSECTORÅBUFFERÅENDÅRMBÅ2OTSBSÅRMBÅ128ÅOUTPUTÅSECTORÅBUFFERÅPAGE*ÅINPUTÅFILEÅNAMEÅPACKET*IFNAMEÅFDBÅ0ÅINPUTÅFILEÅPOINTERÅFDBÅBKCLUNÅINPUTÅFILEÅNAMEÅBUFFER**ÅMOVEÅUTILITYÅPACKET*INMPLXÅFDBÅBKCLUNÅFDBÅINCLUN*INRPLXÅFDBÅBKCLUNÅFDBÅINCLUN*NXMPLXÅFDBÅBKCLUNÅFDBÅOTCLUN*OTMPLXÅFDBÅDFCLUNÅFDBÅOTCLUN*CHGPLXÅFDBÅOTCLUNÅFDBÅINCLUN**ÅRMBÅ3ÅGUARDÅSPACE**CMBGNÅEQUÅ*ÅCOMMANDÅBUFFERÅSTARTSÅHERE**ÅPGREMÅEQUÅ-(-*/256*256+*)+256ÅCALCULATEÅBYTESÅREMAININGÅINÅTHISÅPAGE*ÅRMBÅ1024ÅRESERVEÅ1024ÅBYTES*CMENDÅEQUÅ*ÅCOMMANDÅBUFFERÅEND*ÅRMBÅ3ÅGUARDÅSPACE*BFBGNÅEQUÅ*ÅTEXTÅBUFFERÅBEGINSÅHERE**ÅENDÅSTARTÅMON 