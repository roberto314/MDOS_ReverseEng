 AS V1.42 Beta [Bld 216] - Source File bootloader_commented.asm - Page 1 - 2026-01-23 11:21:24


       1/       0 :                     ; This file is loaded from floppy to address $20
       2/       0 :                     ; It sits in sector $17 @ 0xB80
       3/       0 :                     ;****************************************************
       4/       0 :                     ; Used Labels
       5/       0 :                     ;****************************************************
       6/       0 :                     
       7/       0 : =$0                  CURDRV  EQU     $0000
       8/       0 : =$1                  STRSCTH EQU     $0001
       9/       0 : =$2                  STRSCTL EQU     $0002
      10/       0 : =$3                  NUMSCTH EQU     $0003
      11/       0 : =$4                  NUMSCTL EQU     $0004
      12/       0 : =$5                  LSCTLN  EQU     $0005
      13/       0 : =$6                  CURADRH EQU     $0006
      14/       0 : =$7                  CURADRL EQU     $0007
      15/       0 : =$8                  FDSTAT  EQU     $0008
      16/       0 : =$B                  SECTCNTH EQU     $000B
      17/       0 : =$C                  SECTCNTL EQU     $000C
      18/       0 : =$E853               CHKERR  EQU     $E853
      19/       0 : =$E86D               READPS  EQU     $E86D
      20/       0 : =$E875               RESTOR  EQU     $E875
      21/       0 : =$EBC0               LPINIT  EQU     $EBC0
      22/       0 :                     
      23/       0 :                     ;****************************************************
      24/       0 :                     ; Program's Code Areas
      25/       0 :                     ;****************************************************
      26/       0 :                     
      27/       0 :                     ; RIB from System disk
      28/       0 :                     ;      00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F
      29/       0 :                     ;-----------------------------------------------------
      30/       0 :                     ; 00 - 40 06 80 3F 00 00 00 00 00 00 00 00 00 00 00 00
      31/       0 :                     ; 10 - 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
      32/       0 :                     ; 20 - 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
      33/       0 :                     ; 30 - 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
      34/       0 :                     ; 40 - 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
      35/       0 :                     ; 50 - 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
      36/       0 :                     ; 60 - 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
      37/       0 :                     ; 70 - 00 00 00 00 00 10 00 40 01 00 06 23 00 00 00 00
      38/       0 :                     
      39/      20 :                                     ORG     $0020
      40/      20 :                     
      41/      20 : 7C 00 00                            INC     CURDRV                   ; 0020: 7C 00 00  ; Why?
      42/      23 : BD E8 75                            JSR     RESTOR                   ; 0023: BD E8 75  ; 
      43/      26 : BD EB C0                            JSR     LPINIT                   ; 0026: BD EB C0  ; 
      44/      29 : CE 00 A0                            LDX     #$00A0                   ; 0029: CE 00 A0  ; Start of RIB in Memory 128 + $20 = $A0
      45/      2C : A6 75                               LDAA    $75,X                    ; 002C: A6 75     ; RIB $75: the number of bytes to load from the last sector
      46/      2E : 97 05                               STAA    LSCTLN                   ; 002E: 97 05     ; LAST SECTOR LENGTH ($10)
      47/      30 : E6 00                               LDAB    ,X                       ; 0030: E6 00     ; X is at $A0, Get Segment descriptor word ($40)
      48/      32 : 2B 58                               BMI     SERRQM                   ; 0032: 2B 58     ; RIB SDW Bit 7 set - Error '?'
      49/      34 : C4 03                               ANDB    #$03                     ; 0034: C4 03     ; isolate Bit 0,1 - is part of starting cluster number
      50/      36 : A6 01                               LDAA    $01,X                    ; 0036: A6 01     ; LDA from $A1, Get Segment descriptor word ($06)
      51/      38 : 48                                  ASLA                             ; 0038: 48        ; 
      52/      39 : 59                                  ROLB                             ; 0039: 59        ; *2
      53/      3A : 48                                  ASLA                             ; 003A: 48        ; 
      54/      3B : 59                                  ROLB                             ; 003B: 59        ; *4 - four sectors / cluster (6 * 4 = 24)
      55/      3C : 8B 01                               ADDA    #$01                     ; 003C: 8B 01     ; |
      56/      3E : C9 00                               ADCB    #$00                     ; 003E: C9 00     ; +1 (25, $19)
      57/      40 : D7 01                               STAB    STRSCTH                  ; 0040: D7 01     ; |
      58/      42 : 97 02                               STAA    STRSCTL                  ; 0042: 97 02     ; Startsector (25, $19) 25*128=$C80
      59/      44 : A6 77                               LDAA    $77,X                    ; 0044: A6 77     ; |
      60/      46 : E6 76                               LDAB    $76,X                    ; 0046: E6 76     ; ($76,77), the number of sectors to load ($0040)
 AS V1.42 Beta [Bld 216] - Source File bootloader_commented.asm - Page 2 - 2026-01-23 11:21:24


      61/      48 : 97 04                               STAA    NUMSCTL                  ; 0048: 97 04     ; |
      62/      4A : D7 03                               STAB    NUMSCTH                  ; 004A: D7 03     ; save
      63/      4C : E6 7A                               LDAB    $7A,X                    ; 004C: E6 7A     ; |
      64/      4E : A6 7B                               LDAA    $7B,X                    ; 004E: A6 7B     ; ($7A,7B), the starting execution address ($0623)
      65/      50 : 36                                  PSHA                             ; 0050: 36        ; 
      66/      51 : 37                                  PSHB                             ; 0051: 37        ; 
      67/      52 : EE 78                               LDX     $78,X                    ; 0052: EE 78     ; ($78,79), the starting load address ($0100)
      68/      54 : DF 06                               STX     CURADRH                  ; 0054: DF 06     ; save
      69/      56 : 96 04                               LDAA    NUMSCTL                  ; 0056: 96 04     ; 
      70/      58 : D6 03                               LDAB    NUMSCTH                  ; 0058: D6 03     ; 
      71/      5A : CE 00 07                            LDX     #$07                     ; 005A: CE 00 07  ; |
      72/      5D : 48                  Z005D           ASLA                             ; 005D: 48        ; |
      73/      5E : 59                                  ROLB                             ; 005E: 59        ; | multiply by 128 to get bytecount
      74/      5F : 09                                  DEX                              ; 005F: 09        ; |
      75/      60 : 26 FB                               BNE     Z005D                    ; 0060: 26 FB     ; |
      76/      62 : 9B 07                               ADDA    CURADRL                  ; 0062: 9B 07     ; |
      77/      64 : D9 06                               ADCB    CURADRH                  ; 0064: D9 06     ; add start address
      78/      66 : 97 0C                               STAA    SECTCNTL                 ; 0066: 97 0C     ; |
      79/      68 : D7 0B                               STAB    SECTCNTH                 ; 0068: D7 0B     ; is actually Endaddress
      80/      6A : CE 03 FF                            LDX     #$03FF                   ; 006A: CE 03 FF  ; 
      81/      6D : 86 4D               Z006D           LDAA    #$4D                     ; 006D: 86 4D     ; Check Memory @ $400 upwards
      82/      6F : 08                                  INX                              ; 006F: 08        ; 
      83/      70 : E6 00                               LDAB    ,X                       ; 0070: E6 00     ; Load whats there
      84/      72 : A7 00                               STAA    ,X                       ; 0072: A7 00     ; write $4D
      85/      74 : A1 00                               CMPA    ,X                       ; 0074: A1 00     ; compare
      86/      76 : 07                                  TPA                              ; 0076: 07        ; Transfer Status to A
      87/      77 : E7 00                               STAB    ,X                       ; 0077: E7 00     ; write the old value back
      88/      79 : 06                                  TAP                              ; 0079: 06        ; restore status reg.
      89/      7A : 26 18                               BNE     SERRM                    ; 007A: 26 18     ; if not zero - Error 'M'
      90/      7C : 9C 0B                               CPX     SECTCNTH                 ; 007C: 9C 0B     ; are we done?
      91/      7E : 26 ED                               BNE     Z006D                    ; 007E: 26 ED     ; no - continue
      92/      80 : 7F 00 00                            CLR     CURDRV                   ; 0080: 7F 00 00  ; go back to drive 0
      93/      83 : 86 53                               LDAA    #$53                     ; 0083: 86 53     ; |
      94/      85 : 36                                  PSHA                             ; 0085: 36        ; |
      95/      86 : 86 E8                               LDAA    #$E8                     ; 0086: 86 E8     ; |
      96/      88 : 36                                  PSHA                             ; 0088: 36        ; E853 is CHKERR
      97/      89 : 7E E8 6D                            JMP     READPS                   ; 0089: 7E E8 6D  ; on stack is CHKERR and Execution Address
      98/      8C :                     ;------------------------------------------------
      99/      8C : 86 3F               SERRQM          LDAA    #'?'                     ; 008C: 86 3F     ; 
     100/      8E : 97 08               Z008E           STAA    FDSTAT                   ; 008E: 97 08     ; 
     101/      90 : 0D                                  SEC                              ; 0090: 0D        ; 
     102/      91 : 7E E8 53                            JMP     CHKERR                   ; 0091: 7E E8 53  ; 
     103/      94 :                     
     104/      94 : 86 4D               SERRM           LDAA    #'M'                     ; 0094: 86 4D     ; 
     105/      96 : 20 F6                               BRA     Z008E                    ; 0096: 20 F6     ; 
     106/      98 :                     ;------------------------------------------------
     107/      98 : 00                                  FCB     $00                      ; 0098: 00        ; filler
     108/      99 : 00                                  FCB     $00                      ; 0099: 00        ; |
     109/      9A : 00                                  FCB     $00                      ; 009A: 00        ; |
     110/      9B : 00                                  FCB     $00                      ; 009B: 00        ; |
     111/      9C : 00                                  FCB     $00                      ; 009C: 00        ; |
     112/      9D : 00                                  FCB     $00                      ; 009D: 00        ; |
     113/      9E : 00                                  FCB     $00                      ; 009E: 00        ; |
     114/      9F : 00                                  FCB     $00                      ; 009F: 00        ; |
     115/      A0 :                     
     116/      A0 :                     
     117/      A0 :                                     END
 AS V1.42 Beta [Bld 216] - Source File bootloader_commented.asm - Page 3 - 2026-01-23 11:21:24


  Symbol Table (* = unused):
  --------------------------

*ARCHITECTURE :                                      "x86_64-unknown-linux" - |
*BIGENDIAN :                      0 - | *BRANCHEXT :                      0 - |
*CASESENSITIVE :                  0 - |  CHKERR :                      E853 - |
*COMPMODE :                       0 - | *CONSTPI :        3.141592653589793 - |
 CURADRH :                        6 - |  CURADRL :                        7 - |
 CURDRV :                         0 - | *CUSTOM :                         0 - |
*DATE :                "2026-01-23" - | *FALSE :                          0 - |
 FDSTAT :                         8 - | *FULLPMMU :                       1 - |
*HAS64 :                          1 - | *HASDSP :                         0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
*INEXTMODE :                      0 - | *INLWORDMODE :                    0 - |
*INMAXMODE :                      0 - | *INSRCMODE :                      0 - |
*INSUPMODE :                      0 - | *LISTON :                         1 - |
 LPINIT :                      EBC0 - |  LSCTLN :                         5 - |
*MACEXP :                         7 - | *MOMCPU :                      6800 - |
*MOMCPUNAME :                "6800" - | *NESTMAX :                      100 - |
 NUMSCTH :                        3 - |  NUMSCTL :                        4 - |
*PACKING :                        0 - | *PADDING :                        0 - |
 READPS :                      E86D - | *RELAXED :                        0 - |
 RESTOR :                      E875 - |  SECTCNTH :                       B - |
 SECTCNTL :                       C - |  SERRM :                         94 C |
 SERRQM :                        8C C |  STRSCTH :                        1 - |
 STRSCTL :                        2 - | *TIME :                  "11:21:24" - |
*TRUE :                           1 - | *VERSION :                     142F - |
 Z005D :                         5D C |  Z006D :                         6D C |
 Z008E :                         8E C | *Z80SYNTAX :                      0 - |

     51 symbols
     31 unused symbols

 AS V1.42 Beta [Bld 216] - Source File bootloader_commented.asm - Page 4 - 2026-01-23 11:21:24


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.00 seconds assembly time

    118 lines source file
      2 passes
      0 errors
      0 warnings
