file mdos.sy 100
option 6800
#option ldchar :
#option schowzero
#option noasc
#option noaddr #disable for comments
#option nohex #disable for comments
option noflex
option nofcc
#option noforced # makes > before variable
include common.info

word 100-11f
label 100 MDOSs
label 100 VERSss
label 102 REVSss
label 104 KYIsSV
label 106 ENDOSs
label 108 ENDUSs
label 10A ENDSYs
label 10E RIBBAs
label 110 ENDRVs
label 112 GDBAs
label 114 SYERRs
label 116 SWIsSV
label 118 SWIsUV
label 11A IRQsUV
label 11C IRQsSV
label 11E CHFLGs
label 120 SYIOCB
label 145 SYPOCB
label 16A SYEOCB
used 623 SYSSTART
lcomment 623 Entry Point after floppy-boot
label 026B ISR_UNUSD

comment 22f 
comment 22f Stack after SWI:
comment 22f [[SP]] ← [PC(LO)]     | +7 | E7FF | 4C
comment 22f [[SP] - 1] ← [PC(HI)] | +6 | E7FE | 20
comment 22f [[SP] - 2] ← [X(LO)]  | +5 | E7FD | A9
comment 22f [[SP] - 3] ← [X(HI)]  | +4 | E7FC | 11
comment 22f [[SP] - 4] ← [A]      | +3 | E7FB | 2F
comment 22f [[SP] - 5] ← [B]      | +2 | E7FA | 02
comment 22f [[SP] - 6] ← [SR]     | +1 | E7F9 | D0
comment 22f [SP] ← [SP] - 7       | +0 | E7F8 | 00
comment 22f [PC(HI)] ← [$FFFA]
comment 22f [PC(LO)] ← [$FFFB]
comment 22f 
lcomment 22f transfer stackp. +1 to X, X<-SP+1 (E7F9)
lcomment 230 load stackpointer with PC (204C)
lcomment 232 decr. SP to 
lcomment 233 get value from after SWI instruction into B, decr. SP
lcomment 234 incr. SP (204D)
lcomment 235 fix return address (jump over the byte after the SWI instr.)
lcomment 237 restore stackp. SP<-X-1
lcomment 238 get status reg value
lcomment 23a move to SR
lcomment 23b get word address
lcomment 23c check for Bit 7 set (Jump to USer Vector)
lcomment 23e is it above $40 ?
lcomment 242 patch LDX ,X two lines below
lcomment 245 get vector table
lcomment 248 get address with offset
lcomment 24a patch JSR command below
lcomment 24d transfer stackp. +1 to X, X<-SP+1 (E7F9)
lcomment 24e load old A from Stack
lcomment 250 push old A to Stack and decrement
lcomment 251 load old SR from Stack to A
lcomment 253 load old B from Stack to B
lcomment 255 load old X from Stack to X
lcomment 257 restore SR
lcomment 258 get A from Stack into A
lcomment 259 JSR to function from Jumptable
lcomment 25c transfer stackp. +1 to X, X<-SP+1 (E7F9)

data 3b7
data 3c9
data 3d6
data 4aa
data 4ac

data 520
data 523
data 526
data 52f
data 532
data 5be
data 5f5
data 602
data 606
data 7c7
data 7cb
data 7f9
data 813
data 815
data 856
data 858
data 85a
data 8cb
data 903
data a61
data a94
data aa5
data ace
data b07
data b0d
data b60
data b76
data bcb
data bcf
data c84
data cba
data cdc
data cf8
data d02
data df6
data e04
data e09
data e14
data e16
data e35
data e45
data f93
data f9a
data 100a
data 1024
data 1067
data 1079
data 125b

data 5dc

char 56a
char 56e
char 572
char 576

label 0279 B7_SET
label 026c B6_SET
lcomment 279 restore B

lcomment 0659 Continue in mdosov6

data 0120-020e
char 14b-15a
char 170-17e

data 65c-750
label c1f TMP1
label c20 TMP2
label c21 TMP3

label bdf HASH
label be6 HASH2
label bf4 HASH25

data f1c-f30
data 27f-2fe
cvec 27f-2fe
label 127f RESRV
label 1282 RELES
label 1c0d OPEN
label 18a3 CLOSE
label 189d GETRC
label 1285 PUTRC
label 18a6 REWND
label 71f GETLS
label 722 PUTLS
label 3a8 KEYIN
label 417 DISPLY
label 41a DISPLX
label 40d DISPLZ

data 419 

data 1101-11f1
char 1128-11f1

comment 1ffd the following code gets overwritten by mdosov6
unused 12a9-1ffc
unused 20cc-20ff
data 2081-208d

label 022F SWI_ISR
label 02FF IRQ_ISR

lcomment 108 gets init to: $2001
lcomment 10a gets init to: $E7FF
lcomment 10c gets init to: $00AE
lcomment 116 gets init to: $F477
lcomment 118 gets init to: $026B
lcomment 11a gets init to: $026B
lcomment 11e gets init to: $8000

comment 1273 the following code gets overwritten by mdosov1
lcomment 1285 gets init to: $7e $150D in mdosov1

#const c559-c55a
#word c6ef-c6f0
#label c63F Set_32Char
#char c724-c741
